<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ã‡elebioÄŸlu Gayrimenkul â€” SÃ¶zleÅŸme YÃ¶netim Sistemi</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#f2f4f8;--bg2:#e6eaf2;--surface:#fff;--surface2:#f7f8fc;
  --dark:#1a1a2e;--dark2:#16213e;
  --brand-blue:#4a9fd4;--brand-teal:#2dd4bf;
  --brand-orange:#c87941;
  --gold:#c9a84c;--gold2:#e0c060;
  --accent:var(--brand-blue);
  --text:#1e2a3a;--muted:#6b7a99;--border:#d4dae8;
  --shadow:0 2px 16px rgba(26,26,46,.08);--shadow-lg:0 8px 40px rgba(26,26,46,.16);
  --r:13px;
  --green:#1a4a2e;--green-bg:#e8f4ec;
  --blue:#1a2d5a;--blue-bg:#e8ecf4;
  --red:#4a1a1a;--red-bg:#f4e8e8;
}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
button{cursor:pointer;border:none;outline:none;font-family:inherit}
input,select,textarea{font-family:inherit;outline:none}
.hidden{display:none!important}
#loadingScreen{position:fixed;inset:0;background:var(--dark);display:flex;align-items:center;justify-content:center;z-index:9999;flex-direction:column;gap:16px}
.ls-spinner{width:40px;height:40px;border:3px solid rgba(201,168,76,.2);border-top-color:#c9a84c;border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.ls-text{color:rgba(255,255,255,.5);font-size:13px;letter-spacing:1px}

/* LOGIN */
#loginPage{min-height:100vh;display:flex;align-items:stretch}
.login-left{flex:1;background:var(--dark);display:flex;flex-direction:column;justify-content:center;padding:70px;position:relative;overflow:hidden}
.login-left::before{content:'';position:absolute;top:-120px;right:-120px;width:500px;height:500px;border-radius:50%;background:radial-gradient(circle,rgba(201,168,76,.15),transparent 65%)}
.login-left::after{content:'';position:absolute;bottom:-80px;left:-80px;width:300px;height:300px;border-radius:50%;background:radial-gradient(circle,rgba(201,168,76,.08),transparent 65%)}
.ll-brand{display:flex;align-items:center;gap:14px;margin-bottom:64px;position:relative;z-index:1}
.ll-icon{width:54px;height:54px;background:#0d1321;border-radius:14px;display:flex;align-items:center;justify-content:center;flex-shrink:0;box-shadow:0 4px 20px rgba(201,168,76,.3);border:1px solid rgba(201,168,76,.2)}
.ll-name{line-height:1.2}
.ll-name-main{display:block;font-size:20px;font-weight:800;letter-spacing:2px;background:linear-gradient(90deg,#4a9fd4,#2dd4bf);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.ll-name-sub{display:block;font-size:10px;font-weight:700;letter-spacing:3px;color:#c87941;margin-top:3px}
.ll-hero{position:relative;z-index:1}
.ll-hero h2{font-family:'Playfair Display',serif;font-size:44px;color:#fff;line-height:1.15;margin-bottom:18px}
.ll-hero h2 em{font-style:italic;color:var(--gold2)}
.ll-hero p{color:rgba(255,255,255,.48);font-size:15px;line-height:1.75;max-width:380px}
.ll-stats{display:flex;gap:48px;margin-top:56px;position:relative;z-index:1}
.ls-num{font-family:'Playfair Display',serif;font-size:30px;color:var(--gold2)}
.ls-lbl{font-size:11px;color:rgba(255,255,255,.38);margin-top:2px}
.login-right{width:490px;background:var(--surface);display:flex;align-items:center;justify-content:center;padding:60px}
.lf-wrap{width:100%}
.lf-wrap h3{font-family:'Playfair Display',serif;font-size:30px;color:var(--dark);margin-bottom:6px}
.lf-wrap>p{color:var(--muted);font-size:14px;margin-bottom:40px}
.fg{margin-bottom:20px}
.fg label{display:block;font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1.2px;margin-bottom:8px}
.fg input,.fg select{width:100%;padding:14px 18px;border:1.5px solid var(--border);border-radius:10px;font-size:15px;color:var(--dark);background:var(--bg);transition:.2s}
.fg input:focus,.fg select:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(201,168,76,.15)}
.login-btn{width:100%;padding:15px;background:linear-gradient(135deg,var(--dark),var(--dark2));color:#fff;border-radius:10px;font-size:15px;font-weight:600;transition:.2s;margin-top:6px}
.login-btn:hover{opacity:.88}.login-btn:active{transform:scale(.99)}
.login-err{display:none;background:#fff0f0;border:1px solid #ffcdd2;color:#c0392b;font-size:13px;text-align:center;margin-top:14px;padding:10px 14px;border-radius:8px;font-weight:500}
.login-hint{text-align:center;margin-top:22px;font-size:13px;color:var(--muted)}
.login-hint code{background:var(--bg2);padding:2px 8px;border-radius:6px;font-family:'DM Mono',monospace;font-size:11px;color:var(--dark)}

/* APP LAYOUT */
#appPage{display:flex;min-height:100vh}
.sidebar{width:258px;background:var(--dark);display:flex;flex-direction:column;padding:26px 0;position:fixed;height:100vh;top:0;left:0;z-index:200}
.sb-brand{display:flex;align-items:center;gap:12px;padding:0 22px 26px;border-bottom:1px solid rgba(255,255,255,.07)}
.sb-icon{width:40px;height:40px;background:#0d1321;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0;border:1px solid rgba(201,168,76,.25)}
.sb-nav{flex:1;padding:18px 10px;overflow-y:auto}
.sb-section{font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,.28);padding:0 12px;margin:16px 0 7px}
.nav-item{display:flex;align-items:center;gap:11px;padding:10px 12px;border-radius:9px;cursor:pointer;color:rgba(255,255,255,.52);font-size:13.5px;font-weight:500;transition:.2s;margin-bottom:1px;user-select:none}
.nav-item:hover{background:rgba(255,255,255,.07);color:rgba(255,255,255,.82)}
.nav-item.active{background:linear-gradient(135deg,rgba(74,159,212,.22),rgba(45,212,191,.12));color:#4a9fd4}
.nav-icon{font-size:16px;width:20px;text-align:center}
.sb-user{padding:14px 22px;border-top:1px solid rgba(255,255,255,.07);display:flex;align-items:center;gap:11px}
.ua{width:35px;height:35px;background:linear-gradient(135deg,var(--brand-blue),var(--brand-teal));border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:#fff;flex-shrink:0}
.ui-name{font-size:13px;color:#fff;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.ui-role{font-size:11px;color:rgba(255,255,255,.38)}
.logout-btn{background:none;color:rgba(255,255,255,.28);font-size:15px;padding:4px;margin-left:auto;transition:.2s}
.logout-btn:hover{color:rgba(255,255,255,.65)}
.main{margin-left:258px;flex:1;min-height:100vh;padding:34px 38px}

/* PAGE HEADER */
.ph{margin-bottom:32px}
.ph h1{font-family:'Playfair Display',serif;font-size:28px;color:var(--dark);margin-bottom:4px}
.ph p{color:var(--muted);font-size:14px}

/* STATS */
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:18px;margin-bottom:32px}
.stat-card{background:var(--surface);border-radius:var(--r);padding:22px;box-shadow:var(--shadow);border:1px solid var(--border);transition:.2s}
.stat-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}
.sc-icon{font-size:22px;margin-bottom:10px}
.sc-num{font-family:'Playfair Display',serif;font-size:30px;color:var(--dark)}
.sc-lbl{font-size:12px;color:var(--muted);margin-top:2px}

/* CONTRACT TYPE CARDS */
.ctype-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-bottom:32px}
.ctype-btn{padding:26px 22px;border-radius:var(--r);display:flex;flex-direction:column;align-items:flex-start;gap:9px;transition:.2s;border:1.5px solid;text-align:left;background:#fff}
.ctype-btn:hover{transform:translateY(-3px);box-shadow:var(--shadow-lg)}
.ctype-btn.satis{border-color:#b8d4c4}.ctype-btn.kira{border-color:#b8c4d4}.ctype-btn.aracilik{border-color:#d4b8b8}
.ctype-icon{font-size:30px}
.ctype-name{font-family:'Playfair Display',serif;font-size:17px;color:var(--dark)}
.ctype-desc{font-size:12px;color:var(--muted);line-height:1.55}
.ctype-arr{font-size:16px;margin-top:6px;transition:.2s}
.ctype-btn:hover .ctype-arr{transform:translateX(4px)}

/* TABLE */
.tbl-wrap{background:var(--surface);border-radius:var(--r);box-shadow:var(--shadow);border:1px solid var(--border);overflow:hidden;margin-bottom:24px}
.tbl-head{padding:18px 22px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.tbl-head h3{font-size:15px;font-weight:600;color:var(--dark);white-space:nowrap}
.search-box{display:flex;align-items:center;gap:8px;background:var(--bg);border:1.5px solid var(--border);border-radius:9px;padding:8px 14px;flex:1;max-width:320px}
.search-box input{background:none;border:none;font-size:13px;color:var(--dark);width:100%}
.search-box input::placeholder{color:var(--muted)}
table{width:100%;border-collapse:collapse}
th{padding:11px 18px;text-align:left;font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1.2px;background:var(--surface2);border-bottom:1px solid var(--border)}
td{padding:12px 18px;font-size:13px;color:var(--dark);border-bottom:1px solid var(--border);vertical-align:middle}
tr:last-child td{border-bottom:none}
tr:hover td{background:var(--bg2)}
.badge{display:inline-flex;align-items:center;padding:3px 10px;border-radius:100px;font-size:10px;font-weight:700;letter-spacing:.3px;white-space:nowrap}
.badge-satis{background:var(--green-bg);color:var(--green)}
.badge-kira{background:var(--blue-bg);color:var(--blue)}
.badge-aracilik{background:var(--red-bg);color:var(--red)}
.badge-taslak{background:#f0f0f0;color:#666}
.badge-ok{background:var(--green-bg);color:var(--green)}
.badge-admin{background:#f5e9c0;color:#7a5a00}
.btn-sm{padding:5px 12px;border-radius:7px;font-size:12px;font-weight:600;background:var(--bg2);color:var(--dark);transition:.2s;border:1px solid var(--border);cursor:pointer}
.btn-sm:hover{background:var(--border)}
.btn-sm.danger{background:var(--red-bg);color:var(--red);border-color:transparent}
.btn-sm.danger:hover{opacity:.8}
.empty-state{text-align:center;padding:48px;color:var(--muted);font-size:14px}

/* FORM PAGE */
.fp-header{display:flex;align-items:center;gap:14px;margin-bottom:28px;flex-wrap:wrap}
.back-btn{display:flex;align-items:center;gap:6px;background:var(--surface);border:1px solid var(--border);border-radius:9px;padding:8px 14px;font-size:13px;color:var(--muted);font-weight:500;transition:.2s;cursor:pointer}
.back-btn:hover{border-color:var(--gold);color:var(--gold)}
.fp-title{font-family:'Playfair Display',serif;font-size:22px;color:var(--dark)}
.type-pill{display:inline-block;font-family:'DM Sans',sans-serif;font-size:10px;font-weight:700;padding:3px 10px;border-radius:8px;margin-left:10px;vertical-align:middle;text-transform:uppercase;letter-spacing:1px}
.form-layout{display:grid;grid-template-columns:1fr 355px;gap:22px;align-items:start}
.form-sections{display:flex;flex-direction:column;gap:18px}
.form-section{background:var(--surface);border-radius:var(--r);border:1px solid var(--border);box-shadow:var(--shadow);overflow:hidden}
.fs-head{padding:15px 22px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px;background:var(--surface2)}
.fs-head h3{font-size:13.5px;font-weight:700;color:var(--dark)}
.fs-icon{font-size:16px}
.fs-body{padding:20px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:13px;margin-bottom:13px}
.form-row.full{grid-template-columns:1fr}
.form-row.three{grid-template-columns:1fr 1fr 1fr}
.form-row.four{grid-template-columns:1fr 1fr 1fr 1fr}
.form-row:last-child{margin-bottom:0}
.field label{display:block;font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.9px;margin-bottom:6px}
.field input,.field select,.field textarea{width:100%;padding:10px 12px;border:1.5px solid var(--border);border-radius:8px;font-size:13.5px;color:var(--dark);background:var(--bg);transition:.2s}
.field input:focus,.field select:focus,.field textarea:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(184,134,11,.09)}
.field textarea{resize:vertical;min-height:72px;line-height:1.6}
.field input[readonly]{background:#f9f7f2;color:var(--muted)}

/* PREVIEW PANEL */
.preview-panel{position:sticky;top:24px;display:flex;flex-direction:column;gap:14px}
.prev-card{background:var(--surface);border-radius:var(--r);border:1px solid var(--border);box-shadow:var(--shadow);overflow:hidden}
.prev-card-head{padding:14px 18px;border-bottom:1px solid var(--border);background:var(--surface2)}
.prev-card-head h3{font-size:13px;font-weight:700;color:var(--dark)}
.prev-card-body{padding:16px}
.pf{margin-bottom:11px;padding-bottom:11px;border-bottom:1px solid var(--border)}
.pf:last-child{margin-bottom:0;padding-bottom:0;border-bottom:none}
.pf-lbl{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:3px}
.pf-val{font-size:13px;color:var(--dark);font-weight:500;min-height:17px}
.pf-val.empty{color:var(--muted);font-style:italic;font-weight:400}
.gen-btn{width:100%;padding:14px;background:linear-gradient(135deg,var(--dark),var(--dark2));color:#fff;border-radius:10px;font-size:14px;font-weight:700;transition:.2s;display:flex;align-items:center;justify-content:center;gap:8px;cursor:pointer}
.gen-btn:hover{opacity:.88}.gen-btn:active{transform:scale(.98)}
.save-draft-btn{width:100%;padding:11px;background:var(--bg2);color:var(--dark);border-radius:10px;font-size:13px;font-weight:600;transition:.2s;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;gap:6px;cursor:pointer}
.save-draft-btn:hover{background:var(--border)}

/* FILTER TABS */
.filter-row{display:flex;gap:8px;padding:14px 20px 0;flex-wrap:wrap}
.filter-btn{padding:7px 15px;border-radius:8px;font-size:13px;font-weight:500;background:var(--surface);border:1px solid var(--border);color:var(--muted);transition:.2s;cursor:pointer}
.filter-btn:hover,.filter-btn.active{background:var(--dark);color:#fff;border-color:var(--dark)}

/* ADMIN PANEL */
.admin-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-bottom:28px}
.admin-stat{background:var(--surface);border-radius:var(--r);padding:20px;box-shadow:var(--shadow);border:1px solid var(--border)}
.admin-stat .num{font-family:'Playfair Display',serif;font-size:28px;color:var(--dark)}
.admin-stat .lbl{font-size:12px;color:var(--muted)}
.staff-avatar{width:32px;height:32px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--dark);background:linear-gradient(135deg,var(--gold),var(--gold2));flex-shrink:0}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(26,24,18,.6);backdrop-filter:blur(4px);z-index:500;display:flex;align-items:center;justify-content:center;padding:20px}
.modal-box{background:var(--surface);border-radius:16px;width:100%;max-width:500px;box-shadow:0 20px 60px rgba(0,0,0,.25);overflow:hidden}
.modal-head{padding:20px 24px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.modal-head h3{font-family:'Playfair Display',serif;font-size:18px;color:var(--dark)}
.modal-body{padding:24px;max-height:70vh;overflow-y:auto}
.modal-foot{padding:16px 24px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:10px}
.btn-primary{padding:10px 20px;background:var(--dark);color:#fff;border-radius:9px;font-size:13px;font-weight:600;cursor:pointer;transition:.2s}
.btn-primary:hover{opacity:.85}
.btn-secondary{padding:10px 20px;background:var(--bg2);color:var(--dark);border-radius:9px;font-size:13px;font-weight:600;cursor:pointer;border:1px solid var(--border);transition:.2s}
.btn-secondary:hover{background:var(--border)}

/* PDF MODAL */
#pdfModal{position:fixed;inset:0;background:rgba(26,24,18,.65);backdrop-filter:blur(5px);z-index:1000;display:flex;align-items:center;justify-content:center;padding:16px}
.pm-wrap{background:#fff;border-radius:16px;width:100%;max-width:860px;max-height:93vh;display:flex;flex-direction:column;box-shadow:0 24px 80px rgba(0,0,0,.32);overflow:hidden}
.pm-head{padding:18px 22px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.pm-head h3{font-family:'Playfair Display',serif;font-size:17px;color:var(--dark)}
.pm-actions{display:flex;gap:9px}
.btn-print{display:flex;align-items:center;gap:6px;padding:9px 18px;background:linear-gradient(135deg,var(--dark),var(--dark2));color:#fff;border-radius:9px;font-size:13px;font-weight:600;cursor:pointer;transition:.2s}
.btn-print:hover{opacity:.85}
.btn-close{padding:9px 14px;background:var(--bg2);color:var(--dark);border-radius:9px;font-size:13px;font-weight:600;cursor:pointer;border:1px solid var(--border);transition:.2s}
.btn-close:hover{background:var(--border)}
.pm-body{overflow-y:auto;flex:1;padding:28px;background:#ede9e1}

/* ============================================================
   PDF DOCUMENT STYLES â€” SÃ¶zleÅŸme baskÄ± gÃ¶rÃ¼nÃ¼mÃ¼
   ============================================================ */
.pdf-doc{background:#fff;padding:52px 58px;box-shadow:0 2px 24px rgba(0,0,0,.09);border-radius:4px;max-width:740px;margin:0 auto;font-size:11.5px;line-height:1.8;color:#1a1812;font-family:'DM Sans',sans-serif}

/* Antet */
.pdf-letterhead{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:28px;padding-bottom:20px;border-bottom:2.5px solid #1a1812}
.pdf-lb-brand{display:flex;align-items:center;gap:12px}
.pdf-lb-icon{width:46px;height:46px;background:#1a1a2e;border-radius:10px;display:flex;align-items:center;justify-content:center;border:1px solid rgba(201,168,76,.3);flex-shrink:0}
.pdf-lb-name{font-family:'Playfair Display',serif;font-size:22px;color:#1a1812}
.pdf-lb-sub{font-size:9px;color:#8a8474;margin-top:2px;font-family:'DM Mono',monospace;letter-spacing:.5px}
.pdf-meta{text-align:right;font-size:10px;color:#8a8474;line-height:2}
.doc-no{font-family:'DM Mono',monospace;font-size:12px;color:#1a1812;font-weight:600;background:#f5e9c0;padding:3px 10px;border-radius:5px;display:inline-block;margin-bottom:4px}

/* BaÅŸlÄ±k */
.pdf-title-block{text-align:center;margin-bottom:28px;padding:20px;background:#f9f7f2;border-radius:8px;border:1px solid #ddd9ce}
.pdf-title-block h2{font-family:'Playfair Display',serif;font-size:15px;text-transform:uppercase;letter-spacing:2px;margin-bottom:8px;color:#1a1812}
.pdf-type-bar{display:inline-block;padding:4px 20px;background:#1a1812;color:#c9960d;font-size:9px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;border-radius:100px}

/* Referans kutusu */
.pdf-ref-box{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;background:#faf8f4;border:1px solid #ddd9ce;border-radius:7px;padding:12px 16px;margin-bottom:24px;font-size:10.5px}
.pdf-ref-k{color:#8a8474;font-weight:700;text-transform:uppercase;letter-spacing:.7px;font-size:9px;margin-bottom:2px}
.pdf-ref-v{color:#1a1812;font-weight:600;font-family:'DM Mono',monospace}

/* Madde baÅŸlÄ±klarÄ± */
.pdf-madde-baslik{font-size:11px;font-weight:700;color:#1a1812;margin:18px 0 8px;text-transform:uppercase;letter-spacing:.5px}

/* Paragraf â€” dÃ¼z metin */
.pdf-p{margin-bottom:10px;text-align:justify;line-height:1.85;font-size:11.5px;color:#1a1812}

/* Tablo â€” taraflar bilgileri */
.pdf-taraf-tablo{width:100%;border-collapse:collapse;margin-bottom:12px;font-size:11px}
.pdf-taraf-tablo td{padding:4px 8px;vertical-align:top;line-height:1.6}
.pdf-taraf-tablo td:first-child{width:160px;color:#8a8474;font-weight:600;font-size:10.5px}
.pdf-taraf-tablo td:last-child{color:#1a1812;font-weight:500}
.pdf-taraf-baslik{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:#5a5040;margin:10px 0 5px;padding:4px 8px;background:#f0ede4;border-radius:4px}

/* TaÅŸÄ±nmaz kutusu */
.pdf-tasÄ±nmaz-box{background:#faf8f4;border:1px solid #ddd9ce;border-radius:7px;padding:14px 18px;margin:10px 0 16px}
.pdf-row{display:grid;grid-template-columns:160px 1fr;gap:4px;margin-bottom:5px;font-size:11px}
.pdf-row:last-child{margin-bottom:0}
.pdf-key{color:#8a8474;font-weight:600;font-size:10.5px}
.pdf-val{color:#1a1812}

/* Ä°mza tablosu */
.pdf-imza-grid{display:grid;gap:20px;margin-top:36px}
.pdf-imza-grid.iki{grid-template-columns:1fr 1fr}
.pdf-imza-grid.dort{grid-template-columns:1fr 1fr 1fr 1fr}
.pdf-imza-box{border:1px solid #c8c0b0;border-radius:6px;padding:14px 16px}
.pdf-imza-lbl{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:#8a8474;margin-bottom:10px}
.pdf-imza-alan{height:50px;border-bottom:1.5px solid #1a1812;margin-bottom:10px}
.pdf-imza-ad{font-size:11.5px;font-weight:600;color:#1a1812}
.pdf-imza-tc{font-size:10px;color:#8a8474;font-family:'DM Mono',monospace;margin-top:2px}
.pdf-imza-tarih{font-size:10px;color:#8a8474;margin-top:4px}

.pdf-divider{border:none;border-top:1px solid #ddd9ce;margin:18px 0}
.pdf-footer-bar{margin-top:28px;padding-top:12px;border-top:1px solid #ddd9ce;display:flex;justify-content:space-between;font-size:9px;color:#aaa;font-family:'DM Mono',monospace}

/* Ã–zel not kutusu */
.pdf-not-box{background:#f5e9c0;border:1px solid #d4a017;border-radius:6px;padding:11px 14px;margin:14px 0;font-size:11px;line-height:1.8}

/* REPORTS */
.report-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:18px;margin-bottom:24px}
.report-card{background:var(--surface);border-radius:var(--r);padding:22px;box-shadow:var(--shadow);border:1px solid var(--border)}
.report-card h3{font-size:13px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:16px}
.chart-bar-wrap{display:flex;flex-direction:column;gap:10px}
.chart-bar-row{display:flex;align-items:center;gap:10px;font-size:12px}
.chart-bar-lbl{width:80px;color:var(--muted);font-size:11px;text-align:right;flex-shrink:0}
.chart-bar-bg{flex:1;height:10px;background:var(--bg2);border-radius:100px;overflow:hidden}
.chart-bar-fill{height:100%;border-radius:100px;transition:width .6s ease}
.chart-bar-val{width:40px;color:var(--dark);font-weight:600;font-size:12px}

/* TOAST */
.toast{position:fixed;bottom:28px;right:28px;background:var(--dark);color:#fff;padding:12px 20px;border-radius:10px;font-size:13.5px;font-weight:500;box-shadow:0 8px 30px rgba(0,0,0,.25);z-index:9999;transform:translateY(20px);opacity:0;transition:.3s}
.toast.show{transform:translateY(0);opacity:1}

/* â”€â”€ MOBÄ°L RESPONSIVE â”€â”€ */
@media(max-width:768px){
  #loginPage{flex-direction:column}
  .login-left{display:none}
  .login-right{width:100%;padding:32px 24px;min-height:100vh}
  .lr-inner{width:100%;max-width:100%}
  .sidebar{width:100%;height:60px;position:fixed;bottom:0;top:auto;left:0;right:0;flex-direction:row;padding:0;z-index:300;border-top:1px solid rgba(255,255,255,.1)}
  .sb-brand{display:none}
  .sb-nav{display:flex;flex-direction:row;padding:0;overflow-x:auto;align-items:center;justify-content:space-around;width:100%;height:100%}
  .sb-nav .nav-item{flex-direction:column;gap:2px;padding:8px 10px;font-size:9px;border-radius:0;margin:0;min-width:56px;align-items:center;justify-content:center;height:100%}
  .nav-icon{font-size:19px;width:auto}
  .sb-user{display:none}
  .main{margin-left:0!important;padding:16px 14px;padding-bottom:76px}
  .stats-grid{grid-template-columns:1fr 1fr;gap:12px}
  .sc-num{font-size:26px}
  .ctype-grid{grid-template-columns:1fr;gap:12px}
  .form-layout{grid-template-columns:1fr;gap:16px}
  .form-row{grid-template-columns:1fr!important;gap:10px}
  .fs-body{padding:14px}
  .preview-panel{order:2}
  .tbl-wrap{overflow-x:auto}
  table{min-width:580px}
  .tbl-head{flex-direction:column;align-items:flex-start;gap:10px}
  .search-box{max-width:100%;width:100%}
  .ph h1{font-size:20px}
  .admin-grid{grid-template-columns:1fr 1fr}
  .report-grid{grid-template-columns:1fr}
  .pm-wrap{max-height:100vh;border-radius:0;width:100%}
  .pm-head{flex-direction:column;gap:8px;align-items:flex-start}
  .pm-actions{width:100%;display:flex;gap:8px}
  .btn-print,.btn-close{flex:1;text-align:center;justify-content:center}
}
/* ============================================================
   PRINT â€” TÃ¼m sayfalarÄ± doÄŸru yazdÄ±r
   ============================================================ */
@media print{
  body>*{display:none!important}
  #pdfModal{display:block!important;position:static!important;background:none!important;padding:0!important;overflow:visible!important}
  .pm-head,.pm-actions{display:none!important}
  .pm-wrap{box-shadow:none!important;max-height:none!important;border-radius:0!important;overflow:visible!important;width:100%!important;margin:0!important}
  .pm-body{padding:0!important;background:#fff!important;overflow:visible!important;max-height:none!important}
  .pdf-doc{box-shadow:none!important;padding:24px!important;max-width:100%!important;margin:0!important}
  *{-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important;color-adjust:exact!important}
}
</style>
</head>
<body>
<!-- LOADING SCREEN -->
<div id="loadingScreen">
  <div class="ls-spinner"></div>
  <div class="ls-text">YÃ¼kleniyor...</div>
</div>

<!-- LOGIN PAGE -->
<div id="loginPage">
  <div class="login-left">
    <div class="ll-brand">
      <div class="ll-icon">
        <svg width="30" height="30" viewBox="0 0 32 32" fill="none"><rect x="2" y="14" width="28" height="16" rx="1" fill="#c9a84c"/><rect x="6" y="10" width="20" height="6" rx="1" fill="#e0c060"/><rect x="10" y="6" width="12" height="6" rx="1" fill="#c9a84c"/><rect x="5" y="17" width="5" height="4" rx=".5" fill="#1a1a2e" opacity=".5"/><rect x="13.5" y="17" width="5" height="4" rx=".5" fill="#1a1a2e" opacity=".5"/><rect x="22" y="17" width="5" height="4" rx=".5" fill="#1a1a2e" opacity=".5"/></svg>
      </div>
      <div class="ll-name">
        <span class="ll-name-main">Ã‡ELEBÄ°OÄLU</span>
        <span class="ll-name-sub">GAYRÄ°MENKUL</span>
      </div>
    </div>
    <div class="ll-hero">
      <h2>Kocaeli'nin<br><em>GÃ¼venilir</em><br>Gayrimenkul UzmanÄ±</h2>
      <p>SatÄ±ÅŸ, kira ve tahliye sÃ¶zleÅŸmelerinizi dakikalar iÃ§inde oluÅŸturun, yÃ¶netin ve arÅŸivleyin.</p>
    </div>
    <div class="ll-stats">
      <div><div class="ls-num">13+</div><div class="ls-lbl">YÄ±llÄ±k TecrÃ¼be</div></div>
      <div><div class="ls-num">2.512</div><div class="ls-lbl">Memnun MÃ¼ÅŸteri</div></div>
      <div><div class="ls-num">2</div><div class="ls-lbl">Ofis â€” Gebze & BaÅŸiskele</div></div>
    </div>
  </div>
  <div class="login-right">
    <div class="lf-wrap">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:28px">
        <div style="width:36px;height:36px;background:#1a1a2e;border-radius:9px;display:flex;align-items:center;justify-content:center;flex-shrink:0">
          <svg width="20" height="20" viewBox="0 0 32 32" fill="none"><rect x="2" y="14" width="28" height="16" rx="1" fill="#c9a84c"/><rect x="6" y="10" width="20" height="6" rx="1" fill="#e0c060"/><rect x="10" y="6" width="12" height="6" rx="1" fill="#c9a84c"/></svg>
        </div>
        <div>
          <div style="font-size:13px;font-weight:800;letter-spacing:1.5px;background:linear-gradient(90deg,#4a9fd4,#2dd4bf);-webkit-background-clip:text;-webkit-text-fill-color:transparent">Ã‡ELEBÄ°OÄLU</div>
          <div style="font-size:9px;font-weight:700;letter-spacing:2px;color:#c87941;text-transform:uppercase">GAYRÄ°MENKUL</div>
        </div>
      </div>
      <h3>GiriÅŸ YapÄ±n</h3>
      <p>HesabÄ±nÄ±za eriÅŸmek iÃ§in bilgilerinizi girin</p>
      <div class="fg"><label>E-posta</label><input type="text" id="loginEmail" placeholder="ornek@celebigayrimenkul.com" autocomplete="off"></div>
      <div class="fg"><label>Åifre</label><input type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="off"></div>
      <button class="login-btn" onclick="doLogin()">GiriÅŸ Yap</button>
      <div class="login-err" id="loginErr">E-posta veya ÅŸifre hatalÄ±.</div>

    </div>
  </div>
</div>

<!-- APP -->
<div id="appPage" class="hidden">
  <div class="sidebar">
    <div class="sb-brand">
      <div class="sb-icon">
        <svg width="20" height="20" viewBox="0 0 32 32" fill="none"><rect x="2" y="14" width="28" height="16" rx="1" fill="#c9a84c"/><rect x="6" y="10" width="20" height="6" rx="1" fill="#e0c060"/><rect x="10" y="6" width="12" height="6" rx="1" fill="#c9a84c"/><rect x="5" y="17" width="5" height="4" rx=".5" fill="#1a1a2e" opacity=".5"/><rect x="13.5" y="17" width="5" height="4" rx=".5" fill="#1a1a2e" opacity=".5"/><rect x="22" y="17" width="5" height="4" rx=".5" fill="#1a1a2e" opacity=".5"/></svg>
      </div>
      <div>
        <div style="font-size:11px;font-weight:800;letter-spacing:1.5px;background:linear-gradient(90deg,#4a9fd4,#2dd4bf);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">Ã‡ELEBÄ°OÄLU</div>
        <div style="font-size:8px;font-weight:700;letter-spacing:2px;color:#c87941">GAYRÄ°MENKUL</div>
      </div>
    </div>
    <nav class="sb-nav">
      <div class="sb-section">Ana MenÃ¼</div>
      <div class="nav-item active" onclick="showPage('dashboard')" id="nav-dashboard"><span class="nav-icon">ğŸ“Š</span> Dashboard</div>
      <div class="nav-item" onclick="showPage('yeni')" id="nav-yeni"><span class="nav-icon">âœï¸</span> Yeni SÃ¶zleÅŸme</div>
      <div class="nav-item" onclick="showPage('sozlesmeler')" id="nav-sozlesmeler"><span class="nav-icon">ğŸ“‹</span> SÃ¶zleÅŸmeler</div>
      <div class="nav-item" onclick="showPage('raporlar')" id="nav-raporlar"><span class="nav-icon">ğŸ“ˆ</span> Raporlar</div>
      <div class="sb-section">Sistem</div>
      <div class="nav-item" onclick="showPage('admin')" id="nav-admin" style="display:none"><span class="nav-icon">âš™ï¸</span> YÃ¶netim Paneli</div>
    </nav>
    <div class="sb-user">
      <div class="ua" id="sbInitials">AY</div>
      <div>
        <div class="ui-name" id="sbName">Admin YÃ¶netici</div>
        <div class="ui-role" id="sbRole">YÃ¶netici</div>
      </div>
      <button class="logout-btn" onclick="doLogout()" title="Ã‡Ä±kÄ±ÅŸ">â»</button>
    </div>
  </div>

  <div class="main">
    <!-- DASHBOARD -->
    <div id="pageDashboard">
      <div class="ph"><h1>Dashboard</h1><p id="dashDate"></p></div>
      <div class="stats-grid">
        <div class="stat-card"><div class="sc-icon">ğŸ“‹</div><div class="sc-num" id="statTotal">0</div><div class="sc-lbl">Toplam SÃ¶zleÅŸme</div></div>
        <div class="stat-card"><div class="sc-icon">ğŸ¡</div><div class="sc-num" id="statSatis">0</div><div class="sc-lbl">SatÄ±ÅŸ SÃ¶zleÅŸmesi</div></div>
        <div class="stat-card"><div class="sc-icon">ğŸ”‘</div><div class="sc-num" id="statKira">0</div><div class="sc-lbl">Kira SÃ¶zleÅŸmesi</div></div>
        <div class="stat-card"><div class="sc-icon">ğŸšª</div><div class="sc-num" id="statAracilik">0</div><div class="sc-lbl">Tahliye TaahhÃ¼dÃ¼</div></div>
      </div>
      <div class="ph" style="margin-bottom:18px"><h1 style="font-size:18px">Yeni SÃ¶zleÅŸme OluÅŸtur</h1></div>
      <div class="ctype-grid">
        <button class="ctype-btn satis" onclick="startForm('satis')"><div class="ctype-icon">ğŸ¡</div><div class="ctype-name">SatÄ±ÅŸ SÃ¶zleÅŸmesi</div><div class="ctype-desc">Gayrimenkule cayma akÃ§eli aracÄ±lÄ±k sÃ¶zleÅŸmesi.</div><div class="ctype-arr">â†’</div></button>
        <button class="ctype-btn kira" onclick="startForm('kira')"><div class="ctype-icon">ğŸ”‘</div><div class="ctype-name">Kira SÃ¶zleÅŸmesi</div><div class="ctype-desc">Konut kira sÃ¶zleÅŸmesi.</div><div class="ctype-arr">â†’</div></button>
        <button class="ctype-btn aracilik" onclick="startForm('tahliye')"><div class="ctype-icon">ğŸšª</div><div class="ctype-name">Tahliye TaahhÃ¼dÃ¼</div><div class="ctype-desc">KiracÄ± tahliye taahhÃ¼t belgesi.</div><div class="ctype-arr">â†’</div></button>
      </div>
      <div class="tbl-wrap">
        <div class="tbl-head"><h3>Son SÃ¶zleÅŸmeler</h3><button class="btn-sm" onclick="showPage('sozlesmeler')">TÃ¼mÃ¼nÃ¼ GÃ¶r â†’</button></div>
        <div id="dashRecentTable"></div>
      </div>
    </div>

    <!-- YENÄ° SÃ–ZLEÅME -->
    <div id="pageYeni" class="hidden">
      <div class="fp-header">
        <button class="back-btn" onclick="showPage('dashboard')">â† Geri</button>
        <div class="fp-title" id="formTitle">Yeni SÃ¶zleÅŸme</div>
      </div>
      <div id="typeSelector">
        <div class="ctype-grid">
          <button class="ctype-btn satis" onclick="startForm('satis')"><div class="ctype-icon">ğŸ¡</div><div class="ctype-name">SatÄ±ÅŸ SÃ¶zleÅŸmesi</div><div class="ctype-desc">Gayrimenkule cayma akÃ§eli aracÄ±lÄ±k sÃ¶zleÅŸmesi.</div><div class="ctype-arr">â†’</div></button>
          <button class="ctype-btn kira" onclick="startForm('kira')"><div class="ctype-icon">ğŸ”‘</div><div class="ctype-name">Kira SÃ¶zleÅŸmesi</div><div class="ctype-desc">Konut kira sÃ¶zleÅŸmesi.</div><div class="ctype-arr">â†’</div></button>
          <button class="ctype-btn aracilik" onclick="startForm('tahliye')"><div class="ctype-icon">ğŸšª</div><div class="ctype-name">Tahliye TaahhÃ¼dÃ¼</div><div class="ctype-desc">KiracÄ± tahliye taahhÃ¼t belgesi.</div><div class="ctype-arr">â†’</div></button>
        </div>
      </div>
      <div id="formContent" class="hidden">
        <div class="form-layout">
          <div class="form-sections" id="formSections"></div>
          <div class="preview-panel">
            <div class="prev-card">
              <div class="prev-card-head"><h3>ğŸ“„ Ã–zet Ã–nizleme</h3></div>
              <div class="prev-card-body" id="previewBody"></div>
            </div>
            <button class="gen-btn" onclick="generateContract()">ğŸ“„ SÃ¶zleÅŸme OluÅŸtur</button>
            <button class="save-draft-btn" onclick="saveDraft()">ğŸ’¾ Taslak Kaydet</button>
          </div>
        </div>
      </div>
    </div>

    <!-- SÃ–ZLEÅMELER -->
    <div id="pageSozlesmeler" class="hidden">
      <div class="ph"><h1>SÃ¶zleÅŸmeler</h1><p>TÃ¼m sÃ¶zleÅŸmelerinizi yÃ¶netin</p></div>
      <div class="tbl-wrap">
        <div class="filter-row">
          <button class="filter-btn active" onclick="filterContracts('hepsi',this)">Hepsi</button>
          <button class="filter-btn" onclick="filterContracts('satis',this)">ğŸ¡ SatÄ±ÅŸ</button>
          <button class="filter-btn" onclick="filterContracts('kira',this)">ğŸ”‘ Kira</button>
          <button class="filter-btn" onclick="filterContracts('tahliye',this)">ğŸšª Tahliye</button>
        </div>
        <div class="tbl-head" style="border-top:1px solid var(--border)">
          <h3 id="contractCount">TÃ¼m SÃ¶zleÅŸmeler</h3>
          <div class="search-box"><span>ğŸ”</span><input type="text" placeholder="SÃ¶zleÅŸme ara..." oninput="searchContracts(this.value)"></div>
        </div>
        <div id="contractsTable"></div>
      </div>
    </div>

    <!-- RAPORLAR -->
    <div id="pageRaporlar" class="hidden">
      <div class="ph"><h1>Raporlar</h1><p>Ä°statistik ve analizler</p></div>
      <div class="report-grid">
        <div class="report-card"><h3>SÃ¶zleÅŸme TÃ¼rleri</h3><div class="chart-bar-wrap" id="chartTypes"></div></div>
        <div class="report-card"><h3>Son 6 Ay</h3><div class="chart-bar-wrap" id="chartMonths"></div></div>
      </div>
      <div class="tbl-wrap">
        <div class="tbl-head"><h3>Ã–zet Ä°statistikler</h3></div>
        <table><thead><tr><th>Metrik</th><th>DeÄŸer</th><th>AÃ§Ä±klama</th></tr></thead><tbody id="reportTable"></tbody></table>
      </div>
    </div>

    <!-- ADMÄ°N -->
    <div id="pageAdmin" class="hidden">
      <div class="ph"><h1>YÃ¶netim Paneli</h1><p>KullanÄ±cÄ± ve sistem yÃ¶netimi</p></div>
      <div class="admin-grid">
        <div class="admin-stat"><div class="num" id="adminUserCount">0</div><div class="lbl">Toplam KullanÄ±cÄ±</div></div>
        <div class="admin-stat"><div class="num" id="adminAdminCount">0</div><div class="lbl">YÃ¶netici</div></div>
        <div class="admin-stat"><div class="num" id="adminContractCount">0</div><div class="lbl">Toplam SÃ¶zleÅŸme</div></div>
      </div>
      <div class="tbl-wrap" style="margin-bottom:22px">
        <div class="tbl-head"><h3>KullanÄ±cÄ±lar</h3><button class="btn-sm" onclick="openAddUserModal()">+ KullanÄ±cÄ± Ekle</button></div>
        <table><thead><tr><th>KullanÄ±cÄ±</th><th>E-posta</th><th>Rol</th><th>Durum</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="adminUsersTable"></tbody></table>
      </div>
      <div class="tbl-wrap">
        <div class="tbl-head"><h3>ğŸ“Š DanÄ±ÅŸman PerformansÄ±</h3></div>
        <table><thead><tr><th>DanÄ±ÅŸman</th><th style="text-align:center">Toplam</th><th style="text-align:center">SatÄ±ÅŸ</th><th style="text-align:center">Kira</th><th style="text-align:center">Tahliye</th></tr></thead><tbody id="adminPerfTable"></tbody></table>
      </div>
    </div>
  </div>
</div>

<!-- PDF MODAL -->
<div id="pdfModal" class="hidden">
  <div class="pm-wrap">
    <div class="pm-head">
      <h3>ğŸ“„ SÃ¶zleÅŸme Ã–nizleme</h3>
      <div class="pm-actions">
        <button class="btn-print" onclick="printPDF()">ğŸ–¨ï¸ YazdÄ±r / PDF</button>
        <button class="btn-close" onclick="closePdfModal()">âœ• Kapat</button>
      </div>
    </div>
    <div class="pm-body"><div class="pdf-doc" id="pdfContent"></div></div>
  </div>
</div>

<!-- ADD USER MODAL -->
<div id="addUserModal" class="modal-overlay hidden">
  <div class="modal-box">
    <div class="modal-head"><h3>KullanÄ±cÄ± Ekle</h3><button class="btn-sm" onclick="closeAddUserModal()">âœ•</button></div>
    <div class="modal-body">
      <div class="fg"><label>Ad Soyad</label><input type="text" id="newUserName" placeholder="Ad Soyad"></div>
      <div class="fg"><label>E-posta</label><input type="email" id="newUserEmail" placeholder="email@sirket.com"></div>
      <div class="fg"><label>Åifre</label><input type="password" id="newUserPass" placeholder="Åifre"></div>
      <div class="fg"><label>Rol</label><select id="newUserRole"><option value="user">KullanÄ±cÄ±</option><option value="admin">YÃ¶netici</option></select></div>
    </div>
    <div style="padding:0 24px 16px;font-size:12px;color:var(--muted);border-top:1px solid var(--border);padding-top:14px;margin-top:4px">
      <strong>Sorun mu var?</strong> "Zaten kayÄ±tlÄ±" hatasÄ± alÄ±p kullanÄ±cÄ± panelde gÃ¶rÃ¼nmÃ¼yorsa: 
      <a href="#" onclick="fixMissingProfile(event)" style="color:var(--brand-blue)">Profili KurtarmayÄ± Dene</a>
    </div>
    <div class="modal-foot">
      <button class="btn-secondary" onclick="closeAddUserModal()">Ä°ptal</button>
      <button class="btn-primary" onclick="addUser()">Ekle</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>
<script type="module">
// â”€â”€ FÄ°REBASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, createUserWithEmailAndPassword, browserLocalPersistence, setPersistence } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
import { initializeApp as initializeSecondaryApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';

const firebaseConfig = {
  apiKey: "AIzaSyBdMnwQB9UD4-0xzx_RtxrQjePu7n3XeeM",
  authDomain: "celebigayrimenkul-8a0e8.firebaseapp.com",
  projectId: "celebigayrimenkul-8a0e8",
  storageBucket: "celebigayrimenkul-8a0e8.firebasestorage.app",
  messagingSenderId: "74968540757",
  appId: "1:74968540757:web:30a473f8a3be3303f7d6dc"
};
const fbApp = initializeApp(firebaseConfig);
const db = getFirestore(fbApp);
const auth = getAuth(fbApp);

// Oturumu LOCAL olarak sakla â€” tarayÄ±cÄ± kapansa bile devam eder, refresh'te bozulmaz
try { await setPersistence(auth, browserLocalPersistence); } catch(e){ console.warn('Persistence ayarlanamadÄ±:', e); }

// Ä°kincil uygulama â€” kullanÄ±cÄ± oluÅŸtururken mevcut oturumu etkilememek iÃ§in
const secondaryApp = initializeSecondaryApp(firebaseConfig, 'secondary');
const secondaryAuth = getAuth(secondaryApp);

// â”€â”€ GÃœVENLÄ° XSS KORUMASI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function esc(str){
  if(!str) return '';
  return String(str)
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;')
    .replace(/'/g,'&#39;');
}

// â”€â”€ FÄ°RESTORE FONKSÄ°YONLARI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fbSaveContract(c){
  try{ await addDoc(collection(db,'contracts'), c); }
  catch(e){ console.error('KayÄ±t hatasÄ±:',e); showToast('âš ï¸ KayÄ±t hatasÄ±: '+e.message); }
}
async function fbLoadContracts(){
  try{
    const q = query(collection(db,'contracts'), orderBy('date','desc'));
    const snap = await getDocs(q);
    contracts = snap.docs.map(d=>({...d.data(), _docId:d.id}));
  } catch(e){ console.error('YÃ¼kleme hatasÄ±:',e); }
}
async function fbDeleteContract(c){
  try{
    if(c._docId) await deleteDoc(doc(db,'contracts',c._docId));
  } catch(e){ console.error('Silme hatasÄ±:',e); }
}

// KullanÄ±cÄ± profili Firestore'da 'users' koleksiyonunda tutulur
// Åifreler artÄ±k Firebase Auth'ta â€” Firestore'da ÅŸifre yok
async function fbSaveUserProfile(uid, profileData){
  try{
    // Åifreyi asla Firestore'a kaydetme
    const {pass, ...safeData} = profileData;
    await setDoc(doc(db,'users',uid), safeData);
  } catch(e){ console.error('Profil kayÄ±t hatasÄ±:',e); showToast('âš ï¸ Profil kaydedilemedi: '+e.message); }
}
async function fbLoadUserProfile(uid){
  try{
    const snap = await getDoc(doc(db,'users',uid));
    if(snap.exists()) return snap.data();
    return null;
  } catch(e){ 
    console.error('Profil yÃ¼kleme hatasÄ±:', e.code, e.message); 
    return null; 
  }
}
async function fbLoadAllUserProfiles(){
  try{
    const snap = await getDocs(collection(db,'users'));
    return snap.docs.map(d=>({...d.data(), uid:d.id}));
  } catch(e){ console.error('KullanÄ±cÄ± listesi hatasÄ±:',e); return []; }
}
async function fbDeleteUserProfile(uid){
  try{
    await deleteDoc(doc(db,'users',uid));
  } catch(e){ console.error('KullanÄ±cÄ± silme hatasÄ±:',e); }
}

// â”€â”€ VERÄ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let users = [];
let contracts = [];
let currentUser = null, currentFilter = 'hepsi', currentSearchQ = '';
// â”€â”€ BAÅLANGIÃ‡: TÃ¼m sayfalarÄ± gizle, loading gÃ¶ster â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('loginPage').classList.add('hidden');
document.getElementById('appPage').classList.add('hidden');

// â”€â”€ AUTH STATE OBSERVER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Firebase oturum durumunu kontrol eder.
// Ä°LK Ã§aÄŸrÄ±da (sayfa yÃ¼klenince) oturumu geri yÃ¼kler.
// Sonraki Ã§aÄŸrÄ±larda (kullanÄ±cÄ± ekleme gibi) mÃ¼dahale etmez.
let _authInitialized = false;

onAuthStateChanged(auth, async (firebaseUser) => {
  // Ä°lk init: sayfa yeni yÃ¼klendi
  if(!_authInitialized){
    _authInitialized = true;
    if(firebaseUser){
      const profile = await fbLoadUserProfile(firebaseUser.uid);
      if(profile && profile.active !== false){
        currentUser = { ...profile, uid: firebaseUser.uid, id: firebaseUser.uid };
        showApp();
      } else {
        await signOut(auth);
        showLogin();
      }
    } else {
      showLogin();
    }
    return;
  }
  // Sonraki tetiklemeler: sadece logout durumunda login gÃ¶ster
  // (kullanÄ±cÄ± ekleme sÄ±rasÄ±nda secondaryAuth signOut tetikler â€” bunu yok say)
  if(!firebaseUser && currentUser === null){
    showLogin();
  }
});

function showLogin(){
  document.getElementById('loadingScreen').classList.add('hidden');
  document.getElementById('appPage').classList.add('hidden');
  document.getElementById('loginPage').classList.remove('hidden');
}

function showApp(){
  document.getElementById('loadingScreen').classList.add('hidden');
  document.getElementById('loginPage').classList.add('hidden');
  document.getElementById('appPage').classList.remove('hidden');
  document.getElementById('sbName').textContent = currentUser.name||'';
  document.getElementById('sbRole').textContent = currentUser.role==='admin'?'YÃ¶netici':'DanÄ±ÅŸman';
  document.getElementById('sbInitials').textContent = (currentUser.name||'?').split(' ').map(x=>x[0]).join('').slice(0,2).toUpperCase();
  document.getElementById('nav-admin').style.display = currentUser.role==='admin'?'flex':'none';
  document.getElementById('dashDate').textContent = new Date().toLocaleDateString('tr-TR',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
  fbLoadContracts().then(()=>showPage('dashboard'));
}

// â”€â”€ LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doLogin(){
  const email = document.getElementById('loginEmail').value.trim();
  const pass  = document.getElementById('loginPass').value;
  const errEl = document.getElementById('loginErr');
  const btn   = document.querySelector('.login-btn');

  if(!email||!pass){
    errEl.style.display='block';
    errEl.textContent='E-posta ve ÅŸifre boÅŸ bÄ±rakÄ±lamaz.';
    return;
  }

  btn.disabled = true;
  btn.textContent = 'GiriÅŸ yapÄ±lÄ±yor...';
  errEl.style.display = 'none';

  try {
    const cred = await signInWithEmailAndPassword(auth, email, pass);
    const profile = await fbLoadUserProfile(cred.user.uid);

    if(!profile){
      await signOut(auth);
      errEl.style.display='block';
      errEl.textContent='KullanÄ±cÄ± profili bulunamadÄ±. YÃ¶neticinize baÅŸvurun.';
      return;
    }
    if(profile.active === false){
      await signOut(auth);
      errEl.style.display='block';
      errEl.textContent='HesabÄ±nÄ±z devre dÄ±ÅŸÄ± bÄ±rakÄ±lmÄ±ÅŸ. YÃ¶neticinize baÅŸvurun.';
      return;
    }

    currentUser = { ...profile, uid: cred.user.uid, id: cred.user.uid };
    _authInitialized = true; // onAuthStateChanged tekrar mÃ¼dahale etmesin
    showApp();

  } catch(e){
    errEl.style.display='block';
    if(e.code==='auth/user-not-found'||e.code==='auth/wrong-password'||e.code==='auth/invalid-credential'){
      errEl.textContent='E-posta veya ÅŸifre hatalÄ±.';
    } else if(e.code==='auth/too-many-requests'){
      errEl.textContent='Ã‡ok fazla hatalÄ± giriÅŸ. LÃ¼tfen birkaÃ§ dakika bekleyin.';
    } else {
      errEl.textContent='GiriÅŸ yapÄ±lamadÄ±: '+e.message;
    }
    document.getElementById('loginPass').value='';
  } finally {
    btn.disabled=false;
    btn.textContent='GiriÅŸ Yap';
  }
}

async function doLogout(){
  currentUser = null;
  contracts = [];
  users = [];
  _authInitialized = false; // Sonraki onAuthStateChanged login sayfasÄ±nÄ± gÃ¶stersin
  try{ await signOut(auth); } catch(e){ console.error('Logout hatasÄ±:',e); }
}
document.getElementById('loginPass').addEventListener('keydown',e=>{if(e.key==='Enter')doLogin();});
document.getElementById('loginEmail').addEventListener('keydown',e=>{if(e.key==='Enter')doLogin();});
window.doLogin=doLogin;
window.doLogout=doLogout;

// â”€â”€ SAYFA YÃ–NLENDIRME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const pages=['dashboard','yeni','sozlesmeler','raporlar','admin'];
function cap(s){return s.charAt(0).toUpperCase()+s.slice(1)}
async function showPage(name){
  pages.forEach(p=>{
    const el=document.getElementById('page'+cap(p));
    if(el)el.classList.toggle('hidden',p!==name);
    const nav=document.getElementById('nav-'+p);
    if(nav)nav.classList.toggle('active',p===name);
  });
  if(name==='dashboard'){await fbLoadContracts();renderDashboard();}
  if(name==='sozlesmeler'){await fbLoadContracts();renderContracts();}
  if(name==='raporlar'){await fbLoadContracts();renderReports();}
  if(name==='admin') await renderAdmin();
  if(name==='yeni'){document.getElementById('typeSelector').classList.remove('hidden');document.getElementById('formContent').classList.add('hidden');document.getElementById('formTitle').textContent='Yeni SÃ¶zleÅŸme';}
}
window.showPage=showPage;

function getVisibleContracts(){
  if(currentUser.role==='admin')return contracts;
  return contracts.filter(c=>c.createdBy===currentUser.uid||c.assignedTo===currentUser.uid);
}

function renderDashboard(){
  const visible=getVisibleContracts();
  document.getElementById('statTotal').textContent=visible.length;
  document.getElementById('statSatis').textContent=visible.filter(c=>c.type==='satis').length;
  document.getElementById('statKira').textContent=visible.filter(c=>c.type==='kira').length;
  document.getElementById('statAracilik').textContent=visible.filter(c=>c.type==='tahliye').length;
  document.getElementById('dashRecentTable').innerHTML=renderContractTable([...visible].slice(0,5),false);
}

// â”€â”€ FORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startForm(type){
  showPage('yeni');
  document.getElementById('typeSelector').classList.add('hidden');
  document.getElementById('formContent').classList.remove('hidden');
  const names={satis:'SatÄ±ÅŸ SÃ¶zleÅŸmesi',kira:'Kira SÃ¶zleÅŸmesi',tahliye:'Tahliye TaahhÃ¼dÃ¼'};
  const colors={satis:'#1a4a2e',kira:'#1a2a4a',tahliye:'#4a1a1a'};
  const icons={satis:'ğŸ¡',kira:'ğŸ”‘',tahliye:'ğŸšª'};
  document.getElementById('formTitle').innerHTML=names[type]+`<span class="type-pill" style="background:${colors[type]}20;color:${colors[type]}">${icons[type]} ${names[type]}</span>`;
  document.getElementById('formSections').innerHTML=buildForm(type);
  renderPreview(type);
}
window.startForm=startForm;

function gv(id){const el=document.getElementById(id);return el?el.value:'';}
function fmt(n){if(!n)return 'â€”';const num=parseFloat(n);if(isNaN(num))return n;return num.toLocaleString('tr-TR');}
function d(val){return val||'â€¦â€¦â€¦â€¦â€¦'}

function buildForm(type){
  const today=new Date().toISOString().slice(0,10);
  const rp=()=>`oninput="renderPreview('${type}')"`;

  if(type==='tahliye'){return `
    <div class="form-section"><div class="fs-head"><span class="fs-icon">ğŸšª</span><h3>KiracÄ± Bilgileri</h3></div><div class="fs-body">
      <div class="form-row"><div class="field"><label>KiracÄ± AdÄ± SoyadÄ±</label><input type="text" id="f_kiraci" oninput="renderPreview('tahliye')" placeholder="Ad Soyad"></div>
      <div class="field"><label>TC Kimlik No</label><input type="text" id="f_kiraci_tc" oninput="renderPreview('tahliye')" placeholder="00000000000" maxlength="11"></div></div>
    </div></div>
    <div class="form-section"><div class="fs-head"><span class="fs-icon">ğŸ </span><h3>Kiraya Veren</h3></div><div class="fs-body">
      <div class="form-row"><div class="field"><label>AdÄ± SoyadÄ±</label><input type="text" id="f_kiralayan" oninput="renderPreview('tahliye')" placeholder="Ad Soyad"></div>
      <div class="field"><label>TC Kimlik No</label><input type="text" id="f_kiralayan_tc" oninput="renderPreview('tahliye')" placeholder="00000000000" maxlength="11"></div></div>
    </div></div>
    <div class="form-section"><div class="fs-head"><span class="fs-icon">ğŸ“</span><h3>TaÅŸÄ±nmaz</h3></div><div class="fs-body">
      <div class="form-row three"><div class="field"><label>Ä°l</label><input type="text" id="f_il" oninput="renderPreview('tahliye')" placeholder="Kocaeli"></div>
      <div class="field"><label>Ä°lÃ§e</label><input type="text" id="f_ilce" oninput="renderPreview('tahliye')" placeholder="Gebze"></div>
      <div class="field"><label>Mahalle</label><input type="text" id="f_mahalle" oninput="renderPreview('tahliye')" placeholder="Mahalle"></div></div>
      <div class="form-row three"><div class="field"><label>Ada No</label><input type="text" id="f_ada" oninput="renderPreview('tahliye')" placeholder="123"></div>
      <div class="field"><label>Parsel No</label><input type="text" id="f_parsel" oninput="renderPreview('tahliye')" placeholder="456"></div>
      <div class="field"><label>BaÄŸÄ±msÄ±z BÃ¶lÃ¼m No</label><input type="text" id="f_bb_no" oninput="renderPreview('tahliye')" placeholder="12"></div></div>
      <div class="form-row full"><div class="field"><label>AÃ§Ä±k Adres</label><input type="text" id="f_adres" oninput="renderPreview('tahliye')" placeholder="Tam adres..."></div></div>
    </div></div>
    <div class="form-section"><div class="fs-head"><span class="fs-icon">ğŸ“…</span><h3>Tarihler</h3></div><div class="fs-body">
      <div class="form-row three">
        <div class="field"><label>Kira SÃ¶zleÅŸmesi Tarihi</label><input type="date" id="f_kira_sozlesme_tarihi" oninput="renderPreview('tahliye')"></div>
        <div class="field"><label>TaahhÃ¼t Tarihi</label><input type="date" id="f_tarih" oninput="renderPreview('tahliye')" value="${today}"></div>
        <div class="field"><label>Tahliye Tarihi</label><input type="date" id="f_tahliye_tarihi" oninput="renderPreview('tahliye')"></div>
      </div>
    </div></div>`;}

  if(type==='satis'){return `
    <div class="form-section"><div class="fs-head"><span class="fs-icon">ğŸ¢</span><h3>Emlak Ofisi / DanÄ±ÅŸman</h3></div><div class="fs-body">
      <div class="form-row"><div class="field"><label>DanÄ±ÅŸman AdÄ± SoyadÄ±</label><input type="text" id="f_araci_ad" oninput="renderPreview('satis')" value="${currentUser?.name||''}" placeholder="Ad Soyad"></div>
      <div class="field"><label>DanÄ±ÅŸman TC</label><input type="text" id="f_araci_tc" oninput="renderPreview('satis')" placeholder="00000000000" maxlength="11"></div></div>
      <div class="form-row"><div class="field"><label>DanÄ±ÅŸman Telefon</label><input type="text" id="f_araci_tel" oninput="renderPreview('satis')" placeholder="0532 133 22 23"></div>
      <div class="field"><label>Yetki Belgesi No</label><input type="text" id="f_araci_lisans" oninput="renderPreview('satis')" value="4105800"></div></div>
      <div class="form-row full"><div class="field"><label>Ofis Adresi</label><input type="text" id="f_araci_adres" oninput="renderPreview('satis')" value="Gaziler Mah. Gaziler Cad. 1721 Sk. No: 1/B Gebze/KOCAELÄ°"></div></div>
    </div></div>
    <div class="form-section"><div class="fs-head"><span class="fs-icon">ğŸ‘¤</span><h3>SatÄ±cÄ±</h3></div><div class="fs-body">
      <div class="form-row"><div class="field"><label>AdÄ± SoyadÄ±</label><input type="text" id="f_satici" oninput="renderPreview('satis')" placeholder="Ad Soyad"></div>
      <div class="field"><label>TC Kimlik No</label><input type="text" id="f_satici_tc" oninput="renderPreview('satis')" placeholder="00000000000" maxlength="11"></div></div>
      <div class="form-row"><div class="field"><label>Telefon</label><input type="text" id="f_satici_tel" oninput="renderPreview('satis')" placeholder="0xxx xxx xx xx"></div>
      <div class="field"><label>E-posta</label><input type="text" id="f_satici_email" oninput="renderPreview('satis')" placeholder="email@..."></div></div>
      <div class="form-row full"><div class="field"><label>Adres</label><input type="text" id="f_satici_adres" oninput="renderPreview('satis')" placeholder="Tebligat adresi..."></div></div>
    </div></div>
    <div class="form-section"><div class="fs-head"><span class="fs-icon">ğŸ‘¤</span><h3>AlÄ±cÄ±</h3></div><div class="fs-body">
      <div class="form-row"><div class="field"><label>AdÄ± SoyadÄ±</label><input type="text" id="f_alici" oninput="renderPreview('satis')" placeholder="Ad Soyad"></div>
      <div class="field"><label>TC Kimlik No</label><input type="text" id="f_alici_tc" oninput="renderPreview('satis')" placeholder="00000000000" maxlength="11"></div></div>
      <div class="form-row"><div class="field"><label>Telefon</label><input type="text" id="f_alici_tel" oninput="renderPreview('satis')" placeholder="0xxx xxx xx xx"></div>
      <div class="field"><label>E-posta</label><input type="text" id="f_alici_email" oninput="renderPreview('satis')" placeholder="email@..."></div></div>
      <div class="form-row full"><div class="field"><label>Adres</label><input type="text" id="f_alici_adres" oninput="renderPreview('satis')" placeholder="Tebligat adresi..."></div></div>
    </div></div>
    <div class="form-section"><div class="fs-head"><span class="fs-icon">ğŸ </span><h3>TaÅŸÄ±nmaz</h3></div><div class="fs-body">
      <div class="form-row"><div class="field"><label>Cinsi</label><select id="f_tip" onchange="renderPreview('satis')"><option value="">SeÃ§in...</option><option>Daire</option><option>Villa</option><option>Arsa</option><option>Ä°ÅŸyeri</option><option>DÃ¼kkan</option><option>Depo</option></select></div>
      <div class="field"><label>KullanÄ±m</label><select id="f_kullanim" onchange="renderPreview('satis')"><option value="">SeÃ§in...</option><option>Konut</option><option>Ticari</option></select></div></div>
      <div class="form-row three"><div class="field"><label>Ä°l</label><input type="text" id="f_il" oninput="renderPreview('satis')" placeholder="Kocaeli"></div>
      <div class="field"><label>Ä°lÃ§e</label><input type="text" id="f_ilce" oninput="renderPreview('satis')" placeholder="Gebze"></div>
      <div class="field"><label>Mahalle</label><input type="text" id="f_mahalle" oninput="renderPreview('satis')" placeholder="Mahalle"></div></div>
      <div class="form-row three"><div class="field"><label>Cadde</label><input type="text" id="f_cadde" oninput="renderPreview('satis')" placeholder="Cadde"></div>
      <div class="field"><label>Sokak</label><input type="text" id="f_sokak" oninput="renderPreview('satis')" placeholder="Sokak"></div>
      <div class="field"><label>KapÄ± No</label><input type="text" id="f_kapi_no" oninput="renderPreview('satis')" placeholder="No"></div></div>
      <div class="form-row three"><div class="field"><label>Ada No</label><input type="text" id="f_ada" oninput="renderPreview('satis')" placeholder="123"></div>
      <div class="field"><label>Parsel No</label><input type="text" id="f_parsel" oninput="renderPreview('satis')" placeholder="456"></div>
      <div class="field"><label>BaÄŸÄ±msÄ±z BÃ¶lÃ¼m No</label><input type="text" id="f_bb_no" oninput="renderPreview('satis')" placeholder="12"></div></div>
      <div class="form-row"><div class="field"><label>BrÃ¼t mÂ²</label><input type="number" id="f_m2" oninput="renderPreview('satis')" placeholder="120"></div>
      <div class="field"><label>EKB No (varsa)</label><input type="text" id="f_ekb" oninput="renderPreview('satis')" placeholder="Enerji Kimlik Belgesi No"></div></div>
      <div class="form-row full"><div class="field"><label>Hasar Raporu (e-Devlet)</label><input type="text" id="f_hasar" oninput="renderPreview('satis')" placeholder="Hasar durumu..."></div></div>
      <div class="form-row full"><div class="field"><label>Devir MasraflarÄ±</label><select id="f_devir_masraf" onchange="renderPreview('satis')"><option value="">SeÃ§in...</option><option value="yarÄ± yarÄ±ya">YarÄ± YarÄ±ya</option><option value="alÄ±cÄ± tarafÄ±ndan">AlÄ±cÄ± TarafÄ±ndan</option><option value="satÄ±cÄ± tarafÄ±ndan">SatÄ±cÄ± TarafÄ±ndan</option></select></div></div>
    </div></div>
    <div class="form-section"><div class="fs-head"><span class="fs-icon">ğŸ’°</span><h3>SatÄ±ÅŸ Bedeli</h3></div><div class="fs-body">
      <div class="form-row"><div class="field"><label>SatÄ±ÅŸ Bedeli (â‚º)</label><input type="number" id="f_fiyat" oninput="renderPreview('satis');hesaplaKalan()" placeholder="0"></div>
      <div class="field"><label>Cayma ParasÄ± (â‚º)</label><input type="number" id="f_kapora" oninput="renderPreview('satis');hesaplaKalan()" placeholder="0"></div></div>
      <div class="form-row"><div class="field"><label>Nakit (â‚º)</label><input type="number" id="f_nakit" oninput="renderPreview('satis');hesaplaKalan()" placeholder="0"></div>
      <div class="field"><label>Konut Kredisi (â‚º)</label><input type="number" id="f_kredi" oninput="renderPreview('satis');hesaplaKalan()" placeholder="Yoksa boÅŸ"></div></div>
      <div class="form-row full" id="kredi_detay_row" style="display:none"><div class="field"><label>Kredi BankasÄ±</label><input type="text" id="f_kredi_banka" oninput="renderPreview('satis')" placeholder="Banka AdÄ±"></div></div>
      <div class="form-row full"><div class="field"><label>Kalan (â‚º) â€” Otomatik</label><input type="number" id="f_kalan" readonly placeholder="0"></div></div>
      <div class="form-row"><div class="field"><label>Komisyon (%)</label><input type="number" id="f_komisyon" oninput="renderPreview('satis')" placeholder="2" step="0.1"></div>
      <div class="field"><label>Tapu Devir Tarihi</label><input type="date" id="f_tapu_tarihi" oninput="renderPreview('satis')"></div></div>
      <div class="form-row full"><div class="field"><label>SÃ¶zleÅŸme Tarihi ve Yeri</label><input type="text" id="f_sozlesme_yeri" oninput="renderPreview('satis')" placeholder="Gebze / ${today}"></div></div>
    </div></div>
    <div class="form-section"><div class="fs-head"><span class="fs-icon">ğŸ“</span><h3>Notlar</h3></div><div class="fs-body">
      <div class="form-row full"><div class="field"><label>Notlar</label><textarea id="f_notlar" oninput="renderPreview('satis')" rows="4" placeholder="Ã–zel notlar, eklemeler..."></textarea></div></div>
    </div></div>`;}

  if(type==='kira'){return `
    <div class="form-section"><div class="fs-head"><span class="fs-icon">ğŸ“‹</span><h3>SÃ¶zleÅŸme Bilgileri</h3></div><div class="fs-body">
      <div class="form-row"><div class="field"><label>SÃ¶zleÅŸme Tarihi</label><input type="date" id="f_tarih" oninput="renderPreview('kira')" value="${today}"></div>
      <div class="field"><label>SÃ¶zleÅŸme Yeri</label><input type="text" id="f_ilce" oninput="renderPreview('kira')" placeholder="Gebze"></div></div>
      <div class="form-row full"><div class="field"><label>Konutun AÃ§Ä±k Adresi</label><input type="text" id="f_adres" oninput="renderPreview('kira')" placeholder="Tam aÃ§Ä±k adres..."></div></div>
    </div></div>
    <div class="form-section"><div class="fs-head"><span class="fs-icon">ğŸ </span><h3>Kiraya Veren</h3></div><div class="fs-body">
      <div class="form-row"><div class="field"><label>AdÄ± SoyadÄ±</label><input type="text" id="f_kiralayan" oninput="renderPreview('kira')" placeholder="Ad Soyad"></div>
      <div class="field"><label>TC Kimlik No</label><input type="text" id="f_kiralayan_tc" oninput="renderPreview('kira')" placeholder="00000000000" maxlength="11"></div></div>
      <div class="form-row"><div class="field"><label>AÃ§Ä±k Adres</label><input type="text" id="f_kiralayan_adres" oninput="renderPreview('kira')" placeholder="Adres..."></div>
      <div class="field"><label>Telefon</label><input type="text" id="f_kiralayan_tel" oninput="renderPreview('kira')" placeholder="0xxx xxx xx xx"></div></div>
      <div class="form-row full"><div class="field"><label>IBAN</label><input type="text" id="f_kiralayan_iban" oninput="renderPreview('kira')" placeholder="TR00 0000 0000 0000 0000 0000 00"></div></div>
      <div class="form-row"><div class="field"><label>Banka AdÄ±</label><input type="text" id="f_banka_adi" oninput="renderPreview('kira')" placeholder="Akbank, Ziraat..."></div><div class="field"></div></div>
    </div></div>
    <div class="form-section"><div class="fs-head"><span class="fs-icon">ğŸ‘¤</span><h3>KiracÄ±</h3></div><div class="fs-body">
      <div class="form-row"><div class="field"><label>AdÄ± SoyadÄ±</label><input type="text" id="f_kiraci" oninput="renderPreview('kira')" placeholder="Ad Soyad"></div>
      <div class="field"><label>TC Kimlik No</label><input type="text" id="f_kiraci_tc" oninput="renderPreview('kira')" placeholder="00000000000" maxlength="11"></div></div>
      <div class="form-row"><div class="field"><label>Adres / Mail</label><input type="text" id="f_kiraci_adres" oninput="renderPreview('kira')" placeholder="Adres veya email"></div>
      <div class="field"><label>Telefon</label><input type="text" id="f_kiraci_tel" oninput="renderPreview('kira')" placeholder="0xxx xxx xx xx"></div></div>
    </div></div>
    <div class="form-section"><div class="fs-head"><span class="fs-icon">ğŸ¤</span><h3>MÃ¼ÅŸterek BorÃ§lu â€“ MÃ¼teselsil Kefil</h3></div><div class="fs-body">
      <div class="form-row"><div class="field"><label>AdÄ± SoyadÄ±</label><input type="text" id="f_kefil" oninput="renderPreview('kira')" placeholder="Ad Soyad (opsiyonel)"></div>
      <div class="field"><label>TC Kimlik No</label><input type="text" id="f_kefil_tc" oninput="renderPreview('kira')" placeholder="00000000000" maxlength="11"></div></div>
      <div class="form-row"><div class="field"><label>Adres</label><input type="text" id="f_kefil_adres" oninput="renderPreview('kira')" placeholder="Adres..."></div>
      <div class="field"><label>Telefon</label><input type="text" id="f_kefil_tel" oninput="renderPreview('kira')" placeholder="0xxx xxx xx xx"></div></div>
    </div></div>
    <div class="form-section"><div class="fs-head"><span class="fs-icon">ğŸ’°</span><h3>Kira Bilgileri</h3></div><div class="fs-body">
      <div class="form-row"><div class="field"><label>Tip</label><select id="f_tip" onchange="renderPreview('kira')"><option value="">SeÃ§in...</option><option>Daire - Konut</option><option>Villa - Konut</option><option>DÃ¼kkan - Ticari</option><option>Ä°ÅŸyeri - Ticari</option></select></div>
      <div class="field"><label>AylÄ±k Kira (â‚º)</label><input type="number" id="f_kira" oninput="renderPreview('kira');hesaplaYillikKira()" placeholder="0"></div></div>
      <div class="form-row"><div class="field"><label>YÄ±llÄ±k Kira (â‚º) â€” Otomatik</label><input type="number" id="f_kira_yillik" readonly placeholder="0"></div>
      <div class="field"><label>Depozito (â‚º)</label><input type="number" id="f_depozito" oninput="renderPreview('kira')" placeholder="0"></div></div>
      <div class="form-row"><div class="field"><label>Kira BaÅŸlangÄ±Ã§</label><input type="date" id="f_kira_bas" oninput="renderPreview('kira')" value="${today}"></div>
      <div class="field"><label>SÃ¼re</label><select id="f_kira_sure" onchange="renderPreview('kira')"><option value="1 yÄ±l">1 YÄ±l</option><option value="2 yÄ±l">2 YÄ±l</option><option value="3 yÄ±l">3 YÄ±l</option></select></div></div>
      <div class="form-row"><div class="field"><label>ArtÄ±ÅŸ OranÄ± (TÃœFE %)</label><input type="number" id="f_artis" oninput="renderPreview('kira')" placeholder="TÃœFE" step="0.1"></div>
      <div class="field"><label>Ã–deme GÃ¼nÃ¼</label><input type="number" id="f_odeme_gun" oninput="renderPreview('kira')" value="17" min="1" max="31"></div></div>
      <div class="form-row"><div class="field"><label>DanÄ±ÅŸman AdÄ±</label><input type="text" id="f_araci_ad" oninput="renderPreview('kira')" value="${currentUser?.name||''}" placeholder="Ad Soyad"></div>
      <div class="field"><label>DanÄ±ÅŸman TC</label><input type="text" id="f_araci_tc" oninput="renderPreview('kira')" placeholder="00000000000" maxlength="11"></div></div>
    </div></div>
    <div class="form-section"><div class="fs-head"><span class="fs-icon">ğŸ“¦</span><h3>DemirbaÅŸ Listesi</h3></div><div class="fs-body">
      <div class="form-row full"><div class="field"><label>DemirbaÅŸlar</label><textarea id="f_demirbas" oninput="renderPreview('kira')" placeholder="BuzdolabÄ±, Ã§amaÅŸÄ±r makinesi..."></textarea></div></div>
    </div></div>`;}
}

function hesaplaKalan(){
  const fiyat=parseFloat(gv('f_fiyat'))||0,nakit=parseFloat(gv('f_nakit'))||0,kredi=parseFloat(gv('f_kredi'))||0;
  const kalanEl=document.getElementById('f_kalan');
  if(kalanEl)kalanEl.value=Math.max(0,fiyat-nakit-kredi);
  const dr=document.getElementById('kredi_detay_row');
  if(dr)dr.style.display=kredi>0?'grid':'none';
}
function hesaplaYillikKira(){
  const el=document.getElementById('f_kira_yillik');
  if(el)el.value=(parseFloat(gv('f_kira'))||0)*12;
  renderPreview('kira');
}
window.hesaplaKalan=hesaplaKalan;
window.hesaplaYillikKira=hesaplaYillikKira;

// â”€â”€ Ã–NÄ°ZLEME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderPreview(type){
  const pb=document.getElementById('previewBody');
  if(!pb)return;
  if(type==='satis')pb.innerHTML=pf('TÃ¼r','ğŸ¡ SatÄ±ÅŸ')+pf('SatÄ±cÄ±',gv('f_satici'))+pf('AlÄ±cÄ±',gv('f_alici'))+pf('DanÄ±ÅŸman',gv('f_araci_ad'))+pf('Adres',[gv('f_mahalle'),gv('f_ilce'),gv('f_il')].filter(Boolean).join(', '))+pf('SatÄ±ÅŸ Bedeli',gv('f_fiyat')?fmt(gv('f_fiyat'))+' â‚º':'')+pf('Cayma ParasÄ±',gv('f_kapora')?fmt(gv('f_kapora'))+' â‚º':'');
  else if(type==='kira')pb.innerHTML=pf('TÃ¼r','ğŸ”‘ Kira')+pf('Kiraya Veren',gv('f_kiralayan'))+pf('KiracÄ±',gv('f_kiraci'))+pf('Adres',gv('f_adres'))+pf('AylÄ±k Kira',gv('f_kira')?fmt(gv('f_kira'))+' â‚º':'');
  else pb.innerHTML=pf('TÃ¼r','ğŸšª Tahliye')+pf('KiracÄ±',gv('f_kiraci'))+pf('Kiraya Veren',gv('f_kiralayan'))+pf('Tahliye',gv('f_tahliye_tarihi'));
}
function pf(lbl,val){const empty=!val;return `<div class="pf"><div class="pf-lbl">${lbl}</div><div class="pf-val${empty?' empty':''}">${empty?'DoldurulmadÄ±':val}</div></div>`;}
window.renderPreview=renderPreview;

function detectType(){
  if(document.getElementById('f_satici'))return 'satis';
  if(document.getElementById('f_tahliye_tarihi'))return 'tahliye';
  return 'kira';
}

// â”€â”€ SÃ–ZLEÅME KAYDET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function generateContract(){
  const type=detectType();
  const docNo='SZ-'+new Date().getFullYear()+'-'+String(Math.floor(Math.random()*900)+100);
  document.getElementById('pdfContent').innerHTML=buildPDF(type,docNo);
  document.getElementById('pdfModal').classList.remove('hidden');
  await _saveContract(type,docNo,'tamamlandi');
  showToast('âœ“ SÃ¶zleÅŸme oluÅŸturuldu ve buluta kaydedildi!');
}
async function saveDraft(){
  const type=detectType();
  const docNo='TASLAK-'+Date.now().toString().slice(-5);
  await _saveContract(type,docNo,'taslak');
  showToast('âœ“ Taslak buluta kaydedildi!');
}
async function _saveContract(type,docNo,durum){
  const c={id:docNo,type,date:new Date().toISOString().slice(0,10),durum,createdBy:currentUser.uid,assignedTo:currentUser.uid,createdByName:currentUser.name};

  if(type==='satis'){
    c.satici=gv('f_satici'); c.alici=gv('f_alici');
    c.adres=gv('f_adres')||[gv('f_mahalle'),gv('f_ilce'),gv('f_il')].filter(Boolean).join(', ');
    c.fiyat=gv('f_fiyat');
    // TÃ¼m satis form alanlarÄ±
    c.f_araci_ad=gv('f_araci_ad'); c.f_araci_tc=gv('f_araci_tc');
    c.f_araci_adres=gv('f_araci_adres'); c.f_araci_tel=gv('f_araci_tel');
    c.f_araci_lisans=gv('f_araci_lisans');
    c.f_satici=gv('f_satici'); c.f_satici_tc=gv('f_satici_tc');
    c.f_satici_adres=gv('f_satici_adres'); c.f_satici_email=gv('f_satici_email');
    c.f_satici_tel=gv('f_satici_tel');
    c.f_alici=gv('f_alici'); c.f_alici_tc=gv('f_alici_tc');
    c.f_alici_adres=gv('f_alici_adres'); c.f_alici_email=gv('f_alici_email');
    c.f_alici_tel=gv('f_alici_tel');
    c.f_tip=gv('f_tip'); c.f_kullanim=gv('f_kullanim');
    c.f_il=gv('f_il'); c.f_ilce=gv('f_ilce'); c.f_mahalle=gv('f_mahalle');
    c.f_cadde=gv('f_cadde'); c.f_sokak=gv('f_sokak'); c.f_kapi_no=gv('f_kapi_no');
    c.f_ada=gv('f_ada'); c.f_parsel=gv('f_parsel'); c.f_bb_no=gv('f_bb_no');
    c.f_m2=gv('f_m2'); c.f_ekb=gv('f_ekb'); c.f_hasar=gv('f_hasar');
    c.f_fiyat=gv('f_fiyat'); c.f_kapora=gv('f_kapora');
    c.f_nakit=gv('f_nakit'); c.f_kredi=gv('f_kredi');
    c.f_kredi_banka=gv('f_kredi_banka'); c.f_kalan=gv('f_kalan');
    c.f_komisyon=gv('f_komisyon'); c.f_devir_masraf=gv('f_devir_masraf');
    c.f_tapu_tarihi=gv('f_tapu_tarihi'); c.f_sozlesme_yeri=gv('f_sozlesme_yeri');
    c.f_notlar=gv('f_notlar');

  } else if(type==='kira'){
    c.kiralayan=gv('f_kiralayan'); c.kiraci=gv('f_kiraci');
    c.adres=gv('f_adres'); c.kira=gv('f_kira');
    // TÃ¼m kira form alanlarÄ±
    c.f_tarih=gv('f_tarih'); c.f_ilce=gv('f_ilce'); c.f_adres=gv('f_adres');
    c.f_kiralayan=gv('f_kiralayan'); c.f_kiralayan_tc=gv('f_kiralayan_tc');
    c.f_kiralayan_adres=gv('f_kiralayan_adres'); c.f_kiralayan_tel=gv('f_kiralayan_tel');
    c.f_kiralayan_iban=gv('f_kiralayan_iban'); c.f_banka_adi=gv('f_banka_adi');
    c.f_kiraci=gv('f_kiraci'); c.f_kiraci_tc=gv('f_kiraci_tc');
    c.f_kiraci_adres=gv('f_kiraci_adres'); c.f_kiraci_tel=gv('f_kiraci_tel');
    c.f_kefil=gv('f_kefil'); c.f_kefil_tc=gv('f_kefil_tc');
    c.f_kefil_adres=gv('f_kefil_adres'); c.f_kefil_tel=gv('f_kefil_tel');
    c.f_tip=gv('f_tip'); c.f_kira=gv('f_kira');
    c.f_kira_yillik=gv('f_kira_yillik'); c.f_depozito=gv('f_depozito');
    c.f_kira_bas=gv('f_kira_bas'); c.f_kira_sure=gv('f_kira_sure');
    c.f_artis=gv('f_artis'); c.f_odeme_gun=gv('f_odeme_gun');
    c.f_demirbas=gv('f_demirbas');
    c.f_araci_ad=gv('f_araci_ad'); c.f_araci_tc=gv('f_araci_tc');

  } else {
    c.kiralayan=gv('f_kiralayan'); c.kiraci=gv('f_kiraci'); c.adres=gv('f_adres');
    // TÃ¼m tahliye form alanlarÄ±
    c.f_kiraci=gv('f_kiraci'); c.f_kiraci_tc=gv('f_kiraci_tc');
    c.f_kiralayan=gv('f_kiralayan'); c.f_kiralayan_tc=gv('f_kiralayan_tc');
    c.f_il=gv('f_il'); c.f_ilce=gv('f_ilce'); c.f_mahalle=gv('f_mahalle');
    c.f_ada=gv('f_ada'); c.f_parsel=gv('f_parsel'); c.f_bb_no=gv('f_bb_no');
    c.f_adres=gv('f_adres');
    c.f_kira_sozlesme_tarihi=gv('f_kira_sozlesme_tarihi');
    c.f_tahliye_tarihi=gv('f_tahliye_tarihi'); c.f_tarih=gv('f_tarih');
  }

  showToast('â³ Kaydediliyor...');
  await fbSaveContract(c);
  await fbLoadContracts();
}
window.generateContract=generateContract;
window.saveDraft=saveDraft;

// â”€â”€ PDF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function antet(docNo){
  const today=new Date().toLocaleDateString('tr-TR',{day:'2-digit',month:'long',year:'numeric'});
  return `<div class="pdf-letterhead">
    <div class="pdf-lb-brand">
      <div class="pdf-lb-icon"><svg width="26" height="26" viewBox="0 0 32 32" fill="none"><rect x="2" y="14" width="28" height="16" rx="1" fill="#c9a84c"/><rect x="6" y="10" width="20" height="6" rx="1" fill="#e0c060"/><rect x="10" y="6" width="12" height="6" rx="1" fill="#c9a84c"/><rect x="5" y="17" width="5" height="4" rx=".5" fill="#1a1a2e" opacity=".45"/><rect x="13.5" y="17" width="5" height="4" rx=".5" fill="#1a1a2e" opacity=".45"/><rect x="22" y="17" width="5" height="4" rx=".5" fill="#1a1a2e" opacity=".45"/></svg></div>
      <div><div class="pdf-lb-name"><span style="background:linear-gradient(90deg,#4a9fd4,#2dd4bf);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:800;letter-spacing:1.5px">Ã‡ELEBÄ°OÄLU</span> <span style="color:#c87941;font-weight:700;letter-spacing:2px">GAYRÄ°MENKUL</span></div>
      <div class="pdf-lb-sub">KOCAELÄ° Â· GAYRÄ°MENKUL DANIÅMANLIÄI Â· YETKÄ° BEL. NO: 4105800</div></div>
    </div>
    <div class="pdf-meta"><div class="doc-no">${docNo}</div><br>Tarih: ${today}<br>DanÄ±ÅŸman: ${currentUser?.name||'â€”'}</div>
  </div>`;
}
function buildPDF(type,docNo){
  const today=new Date().toLocaleDateString('tr-TR',{day:'2-digit',month:'long',year:'numeric'});
  if(type==='satis')return buildSatisPDF(docNo,today);
  if(type==='kira')return buildKiraPDF(docNo,today);
  return buildTahliyePDF(docNo,today);
}

function buildSatisPDF(docNo,today){
  const tapuTarihi=gv('f_tapu_tarihi')||'â€¦â€¦ / â€¦â€¦ / â€¦â€¦';
  const cayma=gv('f_kapora')?fmt(gv('f_kapora'))+' TL':'â€¦â€¦â€¦â€¦â€¦';
  const caymaOran=gv('f_kapora')&&gv('f_fiyat')?' (SatÄ±ÅŸ bedelinin %'+Math.round((parseFloat(gv('f_kapora'))/parseFloat(gv('f_fiyat')))*100)+' oranÄ±nda)':'';
  const komisyon=gv('f_komisyon')||'â€¦â€¦';
  const ilce=gv('f_ilce')||'Gebze';
  const hasKredi=!!gv('f_kredi');
  const devir=gv('f_devir_masraf')||'YarÄ± YarÄ±ya';
  return antet(docNo)+`
  <div class="pdf-title-block"><h2>GAYRÄ°MENKUL SATIÅINA CAYMA AKÃ‡ELÄ° ARACILIK SÃ–ZLEÅMESÄ°</h2><div class="pdf-type-bar">ğŸ¡ SATIÅ SÃ–ZLEÅMESÄ°</div></div>
  <div class="pdf-ref-box"><div><div class="pdf-ref-k">SÃ¶zleÅŸme No</div><div class="pdf-ref-v">${docNo}</div></div><div><div class="pdf-ref-k">Tarih</div><div class="pdf-ref-v">${today}</div></div><div><div class="pdf-ref-k">DÃ¼zenleyen</div><div class="pdf-ref-v">${currentUser?.name||'â€”'}</div></div></div>
  <div class="pdf-madde-baslik">MADDE-1) TARAFLAR</div>
  <div class="pdf-taraf-baslik">Emlak Ofisi;</div>
  <table class="pdf-taraf-tablo">
    <tr><td>UnvanÄ±</td><td>: Ã‡elebioÄŸlu Gayrimenkul</td></tr>
    <tr><td>Yetki Belgesi NumarasÄ±</td><td>: ${gv('f_araci_lisans')||'4105800'}</td></tr>
    <tr><td>Sorumlu Emlak DanÄ±ÅŸmanÄ±</td><td>: ${gv('f_araci_ad')||currentUser?.name||'â€”'}</td></tr>
    <tr><td>Adresi</td><td>: ${gv('f_araci_adres')||'Gaziler Mah. Gaziler Cad. 1721 Sk. No: 1/B Gebze/KOCAELÄ°'}</td></tr>
    <tr><td>Ä°letiÅŸim Bilgileri</td><td>: ${gv('f_araci_tel')||'â€”'}</td></tr>
  </table>
  <p class="pdf-p">Ä°ÅŸbu sÃ¶zleÅŸmede Ã‡elebioÄŸlu Gayrimenkul "Emlak Ofisi" olarak anÄ±lacaktÄ±r.</p>
  <div class="pdf-taraf-baslik">SatÄ±cÄ±;</div>
  <table class="pdf-taraf-tablo">
    <tr><td>GerÃ§ek KiÅŸi / AdÄ±-SoyadÄ±</td><td>: ${d(gv('f_satici'))}</td></tr>
    <tr><td>TCKN</td><td>: ${d(gv('f_satici_tc'))}</td></tr>
    <tr><td>Adres</td><td>: ${d(gv('f_satici_adres'))}</td></tr>
    <tr><td>E-Mail</td><td>: ${d(gv('f_satici_email'))}</td></tr>
    <tr><td>Telefon</td><td>: ${d(gv('f_satici_tel'))}</td></tr>
  </table>
  <p class="pdf-p">Ä°ÅŸbu sÃ¶zleÅŸmede "SatÄ±cÄ±" olarak anÄ±lacaktÄ±r.</p>
  <div class="pdf-taraf-baslik">AlÄ±cÄ±;</div>
  <table class="pdf-taraf-tablo">
    <tr><td>GerÃ§ek KiÅŸi / AdÄ±-SoyadÄ±</td><td>: ${d(gv('f_alici'))}</td></tr>
    <tr><td>TCKN</td><td>: ${d(gv('f_alici_tc'))}</td></tr>
    <tr><td>Adres</td><td>: ${d(gv('f_alici_adres'))}</td></tr>
    <tr><td>E-Mail</td><td>: ${d(gv('f_alici_email'))}</td></tr>
    <tr><td>Telefon</td><td>: ${d(gv('f_alici_tel'))}</td></tr>
  </table>
  <p class="pdf-p">Ä°ÅŸbu sÃ¶zleÅŸmede "AlÄ±cÄ±" olarak anÄ±lacaktÄ±r.</p>
  <div class="pdf-madde-baslik">MADDE-2) TAÅINMAZA Ä°LÄ°ÅKÄ°N BÄ°LGÄ°LER</div>
  <div class="pdf-tasÄ±nmaz-box">
    <div class="pdf-row"><div class="pdf-key">Cinsi</div><div class="pdf-val">${d(gv('f_tip'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">Ä°l / Ä°lÃ§e</div><div class="pdf-val">${d(gv('f_il'))} / ${d(gv('f_ilce'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">Mahalle</div><div class="pdf-val">${d(gv('f_mahalle'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">Cadde / Sokak</div><div class="pdf-val">${d(gv('f_cadde'))} / ${d(gv('f_sokak'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">KapÄ± No</div><div class="pdf-val">${d(gv('f_kapi_no'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">BaÄŸÄ±msÄ±z BÃ¶lÃ¼m No</div><div class="pdf-val">${d(gv('f_bb_no'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">Ticari / Konut</div><div class="pdf-val">${d(gv('f_kullanim'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">Tapu (Ada/Parsel)</div><div class="pdf-val">Ada: ${d(gv('f_ada'))} â€” Parsel: ${d(gv('f_parsel'))}</div></div>
    ${gv('f_ekb')?`<div class="pdf-row"><div class="pdf-key">EKB No</div><div class="pdf-val">${gv('f_ekb')}</div></div>`:''}
    <div class="pdf-row"><div class="pdf-key">SatÄ±ÅŸ Bedeli</div><div class="pdf-val">${gv('f_fiyat')?fmt(gv('f_fiyat'))+' TL':'â€¦â€¦â€¦â€¦â€¦'}</div></div>
    <div class="pdf-row"><div class="pdf-key">Ã–deme YÃ¶ntemi</div><div class="pdf-val">${[gv('f_nakit')?'Nakit: '+fmt(gv('f_nakit'))+' TL':'',hasKredi?'Kredi: '+fmt(gv('f_kredi'))+' TL ('+gv('f_kredi_banka')+')':'',gv('f_kalan')&&parseInt(gv('f_kalan'))>0?'Kalan: '+fmt(gv('f_kalan'))+' TL':''].filter(Boolean).join(' + ')||'â€¦â€¦â€¦â€¦â€¦'}</div></div>
    <div class="pdf-row"><div class="pdf-key">Devir MasraflarÄ±</div><div class="pdf-val">${devir}</div></div>
    ${gv('f_hasar')?`<div class="pdf-row"><div class="pdf-key">Hasar Raporu</div><div class="pdf-val">${gv('f_hasar')}</div></div>`:''}
  </div>
  <p class="pdf-p">Ä°ÅŸbu sÃ¶zleÅŸmede "TaÅŸÄ±nmaz" olarak anÄ±lacaktÄ±r.</p>
  <div class="pdf-madde-baslik">MADDE-3) SÃ–ZLEÅMENÄ°N KONUSU</div>
  <p class="pdf-p">Ä°ÅŸbu Gayrimenkul SatÄ±ÅŸÄ±na AracÄ±lÄ±k SÃ¶zleÅŸmesi'nin ("SÃ¶zleÅŸme") konusu, TaÅŸÄ±nmazÄ±n mÃ¼lkiyetini devir iÅŸlemini gerÃ§ekleÅŸtirmek Ã¼zere Emlak Ofisi aracÄ±lÄ±ÄŸÄ±yla bir araya gelen AlÄ±cÄ± ile SatÄ±cÄ±nÄ±n hak ve yÃ¼kÃ¼mlÃ¼lÃ¼kleri ile Emlak Ofisinin haklarÄ±nÄ± dÃ¼zenlemekten ibarettir.</p>
  <div class="pdf-madde-baslik">MADDE-4) GENEL HÃœKÃœMLER</div>
  <p class="pdf-p">AlÄ±cÄ±, SatÄ±cÄ±nÄ±n sahibi veya mÃ¼lkiyetini devretmeye yetkili olduÄŸu TaÅŸÄ±nmazÄ±, 2. maddede anÄ±lan satÄ±ÅŸ bedeli karÅŸÄ±lÄ±ÄŸÄ±nda satÄ±n almayÄ± kabul etmiÅŸtir. Bu sebeple AlÄ±cÄ± ve SatÄ±cÄ±, en geÃ§ <strong>${tapuTarihi}</strong> tarihine kadar ilgili tapu mÃ¼dÃ¼rlÃ¼ÄŸÃ¼ne giderek resmÃ® satÄ±ÅŸ iÅŸlemini gerÃ§ekleÅŸtirmek Ã¼zerinde anlaÅŸmÄ±ÅŸtÄ±r.</p>
  <p class="pdf-p">AlÄ±cÄ±, iÅŸbu SÃ¶zleÅŸmeden herhangi bir gerekÃ§e gÃ¶stermeksizin dÃ¶nebilmek hakkÄ±na haiz olmak ve SatÄ±cÄ±nÄ±n TaÅŸÄ±nmazÄ± tapuda resmÃ® satÄ±ÅŸ iÅŸleminin yapÄ±lacaÄŸÄ± <strong>${tapuTarihi}</strong> tarihine kadar Ã¼Ã§Ã¼ncÃ¼ kiÅŸilere pazarlamamasÄ±, satmamasÄ±, kiralamamasÄ± veya iÅŸbu SÃ¶zleÅŸme ile takip ettiÄŸi menfaatlerini ihlÃ¢l etmemesi iÃ§in iÅŸbu SÃ¶zleÅŸme'nin akdedildiÄŸi tarihte SatÄ±cÄ±ya satÄ±ÅŸ bedelinin <strong>${cayma}${caymaOran}</strong> cayma parasÄ± vermeyi kabul etmiÅŸtir. AlÄ±cÄ±, <strong>${tapuTarihi}</strong> tarihine kadar yÃ¼klendiÄŸi edimini yerine getirmez ve/veya tapu dairesinde satÄ±ÅŸ sÃ¶zleÅŸmesini gerÃ§ekleÅŸtirmez ise, SatÄ±cÄ±nÄ±n Ã¼Ã§Ã¼ncÃ¼ kiÅŸilere pazarlama, satÄ±ÅŸ, kiralama veya TaÅŸÄ±nmaz ile elde edebileceÄŸi sair iktisadÃ® menfaatlere iliÅŸkin iÅŸlemler yapmamÄ±ÅŸ olmasÄ± nedeniyle zararÄ±na ve maÄŸduriyetine sebebiyet vermiÅŸ olacaÄŸÄ±ndan, Ã¶demiÅŸ olduÄŸu cayma parasÄ±nÄ±n geri Ã¶denmesini, SatÄ±cÄ±dan veya Emlak Ofisinden talep edemeyeceÄŸini gayrikabili rÃ¼cu, peÅŸinen, beyan, kabul ve taahhÃ¼t eder.</p>
  <div class="pdf-madde-baslik">MADDE-5) HÄ°ZMET BEDELÄ°</div>
  <p class="pdf-p">Taraflar, <strong>%${komisyon} +KDV</strong> SatÄ±cÄ± ve <strong>%${komisyon} +KDV</strong> AlÄ±cÄ± tarafÄ±ndan Ã¶denecek olmak Ã¼zere, Emlak Ofisine toplamda, 2. maddede belirlenen satÄ±ÅŸ bedelinin Ã¼zerinden anlaÅŸÄ±lan hizmet bedelinin tapuda resmÃ® satÄ±ÅŸ iÅŸleminin yapÄ±lacaÄŸÄ± <strong>${tapuTarihi}</strong> tarihinde Ã¶denmesi Ã¼zerinde anlaÅŸmÄ±ÅŸlardÄ±r. Emlak Ofisi, AlÄ±cÄ± ve SatÄ±cÄ±yÄ± bir araya getirmekle hizmet bedeline hak kazanmÄ±ÅŸ sayÄ±lÄ±r. TaÅŸÄ±nmazÄ±n, AlÄ±cÄ±nÄ±n eÅŸi, niÅŸanlÄ±sÄ±, sÃ¶zlÃ¼sÃ¼, ortaÄŸÄ± veya temsil ettiÄŸi gerÃ§ek veya tÃ¼zel kiÅŸi, ortaklarÄ±, kan ve sÄ±hri hÄ±sÄ±mlarÄ± ve/veya AlÄ±cÄ±nÄ±n herhangi bir dereceden akrabasÄ± olan bir Ã¼Ã§Ã¼ncÃ¼ kiÅŸiye veya akrabasÄ± olmamakla birlikte herhangi bir yakÄ±nÄ±na veya tanÄ±dÄ±ÄŸÄ±na satÄ±lmasÄ± veya bu kiÅŸiler ile satÄ±ÅŸ vaadi, takas/trampa, barter, kat karÅŸÄ±lÄ±ÄŸÄ± inÅŸaat sÃ¶zleÅŸmesi veya nihaÃ® hedefi mÃ¼lkiyetin devri olan sair bir iÅŸlemin yapÄ±lmasÄ± ile mÃ¼lkiyetinin devredilmesi veya devredilmesinin borÃ§lanÄ±lmasÄ± hÃ¢llerinde veya AlÄ±cÄ± ile SatÄ±cÄ±nÄ±n, Emlak Ofisinin hizmet bedelini elde etmesini engelleme amacÄ±yla hareket ettikleri herhangi diÄŸer bir ihtimÃ¢lde de ve fakat bunlarla sÄ±nÄ±rlÄ± olmamak Ã¼zere, Emlak Ofisi hizmet bedeline hak kazanmÄ±ÅŸ sayÄ±lÄ±r.</p>
  <div class="pdf-madde-baslik">MADDE-6) CEZA KOÅULU</div>
  <p class="pdf-p">AlÄ±cÄ± <strong>${tapuTarihi}</strong> tarihinde TaÅŸÄ±nmazÄ± tapu dairesinde satÄ±n almaktan vazgeÃ§erse ya da <strong>${tapuTarihi}</strong> tarihine kadar yÃ¼klendiÄŸi edimini ve/veya tapu dairesinde satÄ±ÅŸ akdini gerÃ§ekleÅŸtirmezse, AlÄ±cÄ± ve SatÄ±cÄ±yÄ± bir araya getirerek edimini eksiksiz biÃ§imde ifa etmiÅŸ olan Emlak Ofisine TaÅŸÄ±nmazÄ±n taraflarca anlaÅŸÄ±lan satÄ±ÅŸ bedeli Ã¼zerinden hizmet bedeli tutarÄ±nca bedeli cezaÃ® ÅŸart olarak Ã¶deyeceÄŸini kabul ve taahhÃ¼t eder. SatÄ±cÄ± <strong>${tapuTarihi}</strong> tarihinde TaÅŸÄ±nmazÄ± tapu dairesinde satmaktan vazgeÃ§erse ya da <strong>${tapuTarihi}</strong> tarihine kadar yÃ¼klendiÄŸi edimini ve/veya tapu dairesinde satÄ±ÅŸ akdini gerÃ§ekleÅŸtirmezse, iÅŸbu SÃ¶zleÅŸme uyarÄ±nca edimini eksiksiz yerine getirmiÅŸ olan Emlak Ofisine TaÅŸÄ±nmazÄ±n taraflarca anlaÅŸÄ±lan satÄ±ÅŸ bedelinin Ã¼zerinden hizmet bedeli tutarÄ±nca bedeli cezaÃ® ÅŸart bedeli Ã¶demeyi kabul ve taahhÃ¼t eder.</p>
  <div class="pdf-madde-baslik">MADDE-7) BÄ°LDÄ°RÄ°MLER</div>
  <p class="pdf-p">Taraflar, iÅŸbu SÃ¶zleÅŸmenin birinci maddesinde anÄ±lan adreslerinin resmÃ® tebligat adresleri olduÄŸunu, bu adresin deÄŸiÅŸmesi halinde diÄŸer tarafa derhÃ¢l yazÄ±lÄ± olarak bildireceklerini, aksi hÃ¢lde birinci maddede yazÄ±lan adrese yapÄ±lan tebligatlarÄ±n geÃ§erli olacaÄŸÄ±nÄ± kabul ederler.</p>
  <div class="pdf-madde-baslik">MADDE-8) DAMGA VERGÄ°SÄ°</div>
  <p class="pdf-p">SÃ¶zleÅŸme ile ilgili damga vergisi SatÄ±cÄ± ve AlÄ±cÄ± tarafÄ±ndan Ã¶denecektir.</p>
  <div class="pdf-madde-baslik">MADDE-9) UYUÅMAZLIK Ã‡Ã–ZÃœMÃœ</div>
  <p class="pdf-p">Taraflar arasÄ±nda <strong>${gv('f_sozlesme_yeri')||today}</strong> tarihinde tanzim edilen iÅŸbu SÃ¶zleÅŸme yukarÄ±daki hususlar ile birlikte geÃ§erli olmak Ã¼zere taraflarca kabul edilmiÅŸ olup, SÃ¶zleÅŸmeden doÄŸacak ihtilaflarda <strong>${ilce}</strong> Mahkeme ve Ä°cra Daireleri yetkilidir.</p>
  <div class="pdf-madde-baslik">NOTLAR:</div>
  <div class="pdf-tasÄ±nmaz-box" style="min-height:80px;white-space:pre-wrap">${gv('f_notlar')||''}</div>
  <hr class="pdf-divider">
  <div class="pdf-imza-grid dort">
    <div class="pdf-imza-box"><div class="pdf-imza-lbl">SATICI</div><div class="pdf-imza-alan"></div><div class="pdf-imza-ad">${gv('f_satici')||'Ad-Soyad:'}</div><div class="pdf-imza-tc">Tckn: ${gv('f_satici_tc')||'â€”'}</div><div class="pdf-imza-tarih">Ä°mza</div></div>
    <div class="pdf-imza-box"><div class="pdf-imza-lbl">ALICI</div><div class="pdf-imza-alan"></div><div class="pdf-imza-ad">${gv('f_alici')||'Ad-Soyad:'}</div><div class="pdf-imza-tc">Tckn: ${gv('f_alici_tc')||'â€”'}</div><div class="pdf-imza-tarih">Ä°mza</div></div>
    <div class="pdf-imza-box"><div class="pdf-imza-lbl">SORUMLU EMLAK DANIÅMANI</div><div class="pdf-imza-alan"></div><div class="pdf-imza-ad">${gv('f_araci_ad')||currentUser?.name||'â€”'}</div><div class="pdf-imza-tc">Tckn: ${gv('f_araci_tc')||'â€”'}</div><div class="pdf-imza-tarih">Ä°mza</div></div>
    <div class="pdf-imza-box"><div class="pdf-imza-lbl">EMLAK OFÄ°SÄ°</div><div class="pdf-imza-alan"></div><div class="pdf-imza-ad">Ã‡elebioÄŸlu Gayrimenkul</div><div class="pdf-imza-tc">Tckn: â€”</div><div class="pdf-imza-tarih">Ä°mza / KaÅŸe</div></div>
  </div>
  <div class="pdf-footer-bar"><span>Ã‡elebioÄŸlu Gayrimenkul Â· Gaziler Mah. Gaziler Cad. 1721 Sk. No: 1/B Gebze/KOCAELÄ°</span><span>${docNo} | ${today}</span></div>`;
}

function buildKiraPDF(docNo,today){
  const ilce=gv('f_ilce')||'Gebze',odemeGun=gv('f_odeme_gun')||'17';
  const kiraAylik=gv('f_kira')?fmt(gv('f_kira'))+' TL':'â€¦â€¦â€¦â€¦â€¦';
  const kiraYillik=gv('f_kira')?fmt(parseFloat(gv('f_kira'))*12)+' TL':'â€¦â€¦â€¦â€¦â€¦';
  const artis=gv('f_artis')?gv('f_artis')+'%':'';
  const depozito=gv('f_depozito')?fmt(gv('f_depozito'))+' TL(TÃœRK LÄ°RASI)':'â€¦â€¦â€¦â€¦â€¦';
  const iban=gv('f_kiralayan_iban')||'â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦';
  const banka=gv('f_banka_adi')||'â€¦â€¦â€¦â€¦â€¦';
  const tarih=gv('f_tarih')||today;
  const demirbas=gv('f_demirbas')||'';
  return antet(docNo)+`
  <div class="pdf-title-block"><h2>KONUT KÄ°RA SÃ–ZLEÅMESÄ°</h2><div class="pdf-type-bar">ğŸ”‘ KÄ°RA SÃ–ZLEÅMESÄ°</div></div>
  <div class="pdf-ref-box"><div><div class="pdf-ref-k">SÃ¶zleÅŸme No</div><div class="pdf-ref-v">${docNo}</div></div><div><div class="pdf-ref-k">Tarih</div><div class="pdf-ref-v">${today}</div></div><div><div class="pdf-ref-k">DÃ¼zenleyen</div><div class="pdf-ref-v">${currentUser?.name||'â€”'}</div></div></div>
  <div class="pdf-tasÄ±nmaz-box" style="margin-bottom:14px">
    <div class="pdf-row"><div class="pdf-key">SÃ–ZLEÅME TARÄ°H VE YERÄ°</div><div class="pdf-val">${tarih} â€” ${ilce}</div></div>
    <div class="pdf-row"><div class="pdf-key">KONUTUN AÃ‡IK ADRESÄ°</div><div class="pdf-val">${d(gv('f_adres'))}</div></div>
  </div>
  <div class="pdf-tasÄ±nmaz-box" style="margin-bottom:14px">
    <div class="pdf-row"><div class="pdf-key">TÄ°PÄ° VE KULLANIM AMACI</div><div class="pdf-val">${d(gv('f_tip'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">BÄ°R AYLIK KÄ°RA BEDELÄ°</div><div class="pdf-val">${kiraAylik}</div></div>
    <div class="pdf-row"><div class="pdf-key">BÄ°R YILLIK KÄ°RA BEDELÄ°</div><div class="pdf-val">${kiraYillik}</div></div>
    <div class="pdf-row"><div class="pdf-key">KÄ°RA BAÅLANGIÃ‡ TARÄ°HÄ°</div><div class="pdf-val">${d(gv('f_kira_bas'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">KÄ°RA SÃ–ZLEÅME SÃœRESÄ°</div><div class="pdf-val">${gv('f_kira_sure')||'1 yÄ±l'}</div></div>
    <div class="pdf-row"><div class="pdf-key">KÄ°RA Ã–DEME ÅEKLÄ°</div><div class="pdf-val">AylÄ±k peÅŸin, her ayÄ±n ${odemeGun}. gÃ¼nÃ¼</div></div>
    <div class="pdf-row"><div class="pdf-key">Ã–DENECEK BANKA VE IBAN NO</div><div class="pdf-val">${banka} â€” ${iban}</div></div>
    <div class="pdf-row"><div class="pdf-key">ALINAN DEPOZÄ°TO MÄ°KTARI</div><div class="pdf-val">${depozito}</div></div>
  </div>
  <div class="pdf-tasÄ±nmaz-box" style="margin-bottom:10px">
    <div class="pdf-row"><div class="pdf-key">KÄ°RAYA VEREN</div><div class="pdf-val"></div></div>
    <div class="pdf-row"><div class="pdf-key">ADIâ€“SOYADIâ€“TC NO</div><div class="pdf-val">${d(gv('f_kiralayan'))} â€” ${d(gv('f_kiralayan_tc'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">AÃ‡IK ADRESÄ°</div><div class="pdf-val">${d(gv('f_kiralayan_adres'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">TELEFON NUMARASI</div><div class="pdf-val">${d(gv('f_kiralayan_tel'))}</div></div>
  </div>
  <div class="pdf-tasÄ±nmaz-box" style="margin-bottom:10px">
    <div class="pdf-row"><div class="pdf-key">KÄ°RACI</div><div class="pdf-val"></div></div>
    <div class="pdf-row"><div class="pdf-key">ADI-SOYADI-TC NO</div><div class="pdf-val">${d(gv('f_kiraci'))} â€” ${d(gv('f_kiraci_tc'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">EV ADRESÄ° / MAÄ°L</div><div class="pdf-val">${d(gv('f_kiraci_adres'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">TELEFON NUMARASI</div><div class="pdf-val">${d(gv('f_kiraci_tel'))}</div></div>
  </div>
  ${gv('f_kefil')?`<div class="pdf-tasÄ±nmaz-box" style="margin-bottom:10px">
    <div class="pdf-row"><div class="pdf-key">MÃœÅTEREK BORÃ‡LU MÃœTESELSÄ°L KEFÄ°L</div><div class="pdf-val"></div></div>
    <div class="pdf-row"><div class="pdf-key">ADI-SOYADI-TC NO</div><div class="pdf-val">${gv('f_kefil')} â€” ${d(gv('f_kefil_tc'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">Ä°Å YA DA EV ADRESÄ°</div><div class="pdf-val">${d(gv('f_kefil_adres'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">TELEFON NUMARASI</div><div class="pdf-val">${d(gv('f_kefil_tel'))}</div></div>
  </div>`:''}
  <div class="pdf-madde-baslik" style="margin-top:18px">A â€“ Genel KoÅŸullar</div>
  <p class="pdf-p">KiracÄ±, mecuru kÄ±smen veya tamamen baÅŸkasÄ±na kiraya veremez. Devir ve ciro edemez ve 3.ÅŸahÄ±slarÄ±n istifadesine tahsis edemez.</p>
  <p class="pdf-p">KiracÄ± mecuru anlaÅŸmada yazÄ±lÄ± olduÄŸu ÅŸekilde, KONUT OLARAK kullanma zorundadÄ±r. Kullanma tarzÄ±nÄ±, ÅŸeklini deÄŸiÅŸtiremez. Bu hususta deÄŸiÅŸiklik, kiraya verenin yazÄ±lÄ± muvafakati ile yapÄ±labilir. Aksi halin tahliye sebebi teÅŸkil edeceÄŸini taraflar kabul, beyan ve taahhÃ¼t ederler.</p>
  <p class="pdf-p">KiracÄ± mecuru yasal tebligat adresi kabul etmiÅŸ olup, iÅŸbu kontrat yÃ¼rÃ¼rlÃ¼kte olduÄŸu sÃ¼rece bu adrese yapÄ±lacak her tÃ¼rlÃ¼ tebligatÄ±n (bila tebliÄŸ dÃ¶nmesi hali dahil) usule uygun ve ÅŸahsÄ±na yapÄ±lmÄ±ÅŸ sayÄ±lacaÄŸÄ±nÄ± ÅŸimdiden kabul ve beyan eder.</p>
  <p class="pdf-p">KiracÄ±, mecur dahilinde, mecurun menfaatine de olsa kiraya verenin yazÄ±lÄ± rÄ±za ve muvafakati olmadan deÄŸiÅŸiklik, tamirat ve ilave yapamaz. TaÅŸÄ±yÄ±cÄ± kolon ve kiriÅŸleri yÄ±kamaz. Her hal ve ÅŸartta ana yapÄ±ya ve statiÄŸine zarar verecek iÅŸler yapÄ±lamaz. Bu madde Ã§erÃ§evesi iÃ§inde yazÄ±lÄ± onay alÄ±narak dahi yapÄ±lan iÅŸlerden ortaya Ã§Ä±kacak hukuki, cezai, mali ve idari tÃ¼m ceza ve sorumluluklar kiracÄ±ya aittir. KiracÄ± kiraladÄ±ÄŸÄ± ÅŸeyi ne halde buldu ise kiraya verene o halde ve adete gÃ¶re teslim etmeye mecburdur.</p>
  <p class="pdf-p">KiracÄ± Yasa ve Belediye mevzuatÄ±na ve nizamlara harfiyen uymak zorundadÄ±r.</p>
  <p class="pdf-p">KiracÄ±, Ã¶demeyi AYLIK periyodlarda peÅŸin olarak yapacaktÄ±r. KiracÄ±nÄ±n Ã¶demeyi yapmakta gecikmesi halinde 6098 sayÄ±lÄ± TÃ¼rk BorÃ§lar Kanunu'nun konut ve Ã§atÄ±lÄ± iÅŸyeri kiralarÄ±nda kiracÄ±nÄ±n temerrÃ¼dÃ¼ne iliÅŸkin hÃ¼kÃ¼mleri uygulanÄ±r.</p>
  <p class="pdf-p">Mecurda kullanÄ±lacak olan elektrik, doÄŸalgaz, su, kapÄ±cÄ±, yÃ¶netim ve yÃ¶netici giderleri, Ã§evre temizliÄŸi, Ã§Ã¶p vergisi kiracÄ±ya aittir. Binaya ait vergi ve demirbaÅŸ giderleri mal sahibine aittir.</p>
  <p class="pdf-p">Ä°ÅŸbu koÅŸullar mezkÃ»r mecura ait kira sÃ¶zleÅŸmesinin ayrÄ±lmaz bir parÃ§asÄ±dÄ±r. Taraflar hÃ¼kÃ¼mlerin aynen tatbik edileceÄŸini kabul, beyan ve taahhÃ¼t ederler.</p>
  <p class="pdf-p">Bu sÃ¶zleÅŸmede yazÄ±lÄ± bulunmayan hÃ¼kÃ¼mlere ihtiyaÃ§ duyulduÄŸunda yÃ¼rÃ¼rlÃ¼kte bulunan BorÃ§lar Kanunu, kat mÃ¼lkiyeti kanunu ve Emsal YargÄ±tay kararlarÄ± uygulanÄ±r.</p>
  <p class="pdf-p">Ä°htilaf vukuunda mecurun adresindeki yer mahkemesi ve icra daireleri yetkilidir. Tebligat adresleri yukarda belirtilen adreslerdir.</p>
  <p class="pdf-p">KiracÄ± mecuru her tÃ¼rlÃ¼ tebligat iÃ§in kanuni ikametgÃ¢h adresi kabul etmiÅŸtir. Ä°ÅŸbu kira sÃ¶zleÅŸmesinin taraflarÄ± ve kefil, adres deÄŸiÅŸikliÄŸini ve yeni adresini karÅŸÄ± tarafa bir hafta iÃ§erisinde bildirmek zorundadÄ±r. Aksi takdirde gÃ¶nderilecek ihtarname, Ã¶deme emri iÅŸbu sÃ¶zleÅŸmede yazÄ±lÄ± adrese gÃ¶nderilir ve bila tebliÄŸ dÃ¶nse dahi alÄ±nmÄ±ÅŸ kabul edilir.</p>
  <p class="pdf-p">KiracÄ±dan, kiralama mÃ¼ddeti sonunda dairenin tahliyesi halinde (elektrik, su, doÄŸalgaz ve apartman ortak giderlerine ait) borcu olmadÄ±ÄŸÄ±na dair makbuzlarÄ± ibraz etmelidir.</p>
  <p class="pdf-p">KiracÄ±nÄ±n, kiralanan dairenin iÃ§inde ve dÄ±ÅŸÄ±nda yaptÄ±racaÄŸÄ± tezyinat masraflarÄ± kendisine ait olacak ve mukavele mÃ¼ddeti bittiÄŸinde yapÄ±lan her tÃ¼rlÃ¼ masraf iÃ§in tazminat istemeye hakkÄ± olmayacak ve bu gayrimenkulde yer alan inÅŸaatÄ±n tamamÄ± mal sahibinin olacaktÄ±r.</p>
  <div class="pdf-madde-baslik">B - Ã–zel KoÅŸullar;</div>
  <p class="pdf-p">SÃ¶zleÅŸme tarihi itibarÄ± ile, kiralanan yere ait su, elektrik, doÄŸalgaz, Ã§Ã¶p vergisi, yÃ¶netim giderleri ve her tÃ¼rlÃ¼ abone masraflarÄ± ile her tÃ¼rlÃ¼ bina ortak giderleri kiracÄ±ya aittir. Bu giderlerin hepsinin veya herhangi birinin Ã¶denmemesi sÃ¶zleÅŸmeye aykÄ±rÄ±lÄ±k sebebiyle, sÃ¶zleÅŸmenin feshine ve tahliye hakkÄ± doÄŸmasÄ±na sebep teÅŸkil eder. Mecur'a ait Elektrik, doÄŸalgaz su aboneliÄŸini, kiracÄ± bir ay iÃ§inde kendi sorumlu olacak ÅŸekilde yapacaktÄ±r, bunu yapmamasÄ± sÃ¶zleÅŸmeye aykÄ±rÄ±lÄ±k ve sÃ¶zleÅŸmenin feshi sebebidir. Bu maddenin dÃ¼zenlemesi aÃ§Ä±sÄ±ndan, kiracÄ± ve kefil TBK 346. da yazan haklarÄ±ndan feragat ettiÄŸini ve bu maddede yazÄ±lÄ± ÅŸartlarÄ± kabul ettiklerini ÅŸimdiden kabul ve taahhÃ¼t eder. KiracÄ±, kiralananÄ±n olaÄŸan kullanÄ±mÄ± iÃ§in gerekli temizlik ve bakÄ±m giderlerini Ã¶demekle yÃ¼kÃ¼mlÃ¼dÃ¼r.</p>
  <p class="pdf-p">KiracÄ± YÃ¶netim PlanÄ±na, Kat MÃ¼lkiyeti Kanuna ve BorÃ§lar Kanunu'na ve KiracÄ± site ve apartman yÃ¶netiminin tÃ¼m kurallarÄ±na uymakla yÃ¼kÃ¼mlÃ¼ olup kurallara uymamak tahliye sebebidir. Site yÃ¶netiminin aldÄ±ÄŸÄ±/alacaÄŸÄ± kurallara aynen uymayÄ± kabul ve taahhÃ¼t eder.</p>
  <p class="pdf-p">Kira bedeli, Ä°ÅŸletme gideri (aidat), kiracÄ±nÄ±n sebep olacaÄŸÄ± her tÃ¼rlÃ¼ zarar, kiracÄ± ile baÄŸlÄ± olmaksÄ±zÄ±n, bu mukavele ile baÄŸlÄ± olarak, kiracÄ±nÄ±n oturduÄŸu sÃ¼rece ve kira akdinin hitamÄ±ndan sonra dahi mÃ¼ÅŸterek borÃ§lu mÃ¼teselsil kefilin kefalet taahhÃ¼dÃ¼ kapsamÄ±ndadÄ±r.</p>
  <p class="pdf-p">KiracÄ± tahliye anÄ±nda mecuru aldÄ±ÄŸÄ± gibi eksiksiz olarak teslim ile yÃ¼kÃ¼mlÃ¼dÃ¼r. GerektiÄŸinde, boya badana ve kullanmadan doÄŸan masraflardan tÃ¼mÃ¼ mal sahibine Ã¶denecektir. Bu bedeller Ã¶ncelikle depozitodan karÅŸÄ±lanacak yetmediÄŸi takdirde kiraya verenin ilk yazÄ±lÄ± talebinden itibaren Ã¼Ã§ gÃ¼n iÃ§inde Ã¶denecektir. Bu maddenin dÃ¼zenlemesi aÃ§Ä±sÄ±ndan, kiracÄ± ve kefil TBK 346. da yazan haklarÄ±ndan feragat ettiÄŸini ve bu maddede yazÄ±lÄ± ÅŸartlarÄ± kabul ettiklerini ÅŸimdiden kabul ve taahhÃ¼t eder. KiracÄ±, kira sÃ¶zleÅŸmesinin sonunda, kiralananÄ± aldÄ±ÄŸÄ± ÅŸekilde, kiraya verene teslim etmek zorundadÄ±r: Keza kiralananla birlikte teslim edilen demirbaÅŸlar da alÄ±ndÄ±ÄŸÄ± ÅŸekilde, kiralanana teslim edilmediÄŸi takdirde, oluÅŸan hasarlarÄ±n bedelinin kiraya ve Ã¶denmesi veya eski hale getirilmesi zorunludur.</p>
  <p class="pdf-p">Ä°ÅŸ bu kira sÃ¶zleÅŸmesinin konusunu teÅŸkil ve 6098 sayÄ±lÄ± BorÃ§lar Kanunu kapsamÄ±nda kiraya verilen mecur kiracÄ± tarafÄ±ndan kiralama amacÄ±na uygun olarak bizzat kendi ihtiyacÄ± iÃ§in kullanacaktÄ±r. KiracÄ±, kiralanan taÅŸÄ±nmazlarÄ±n hiÃ§birini baÅŸkasÄ±nÄ±n kullanÄ±mÄ±na her ne suretle olursa olsun sunamayacaÄŸÄ± gibi, kiralayamaz ve devredemez. Bu durum akde aykÄ±rÄ±lÄ±k sebebi ile akdin feshi sebebidir.</p>
  <p class="pdf-p">KiracÄ±, kiraya verenin yazÄ±lÄ± muvafakatini alarak taÅŸÄ±nmaz Ã¼zerinde mecuru kullanÄ±ÅŸlÄ± hale getirmek, gÃ¼zelleÅŸtirmek ve sair amaÃ§lÄ± yapacaÄŸÄ± her tÃ¼rlÃ¼ tesisat ilave tadilat ve dekorasyonu bila bedel kiraya verene terk edecektir.</p>
  <p class="pdf-p">Kiralanana ait elektrik, su yakÄ±t giderleri, kalorifer tesisatÄ± ve diÄŸer tesisatlarÄ±n kullanÄ±lmasÄ±ndan kaynaklanan bakÄ±m onarÄ±m masraflarÄ±, resmi makamlarca talep edilecek elektrik, doÄŸalgaz ve su saatleri aÃ§tÄ±rma, kapatma ve deÄŸiÅŸtirme bakÄ±m ve onarÄ±m masraflarÄ±, tesise iÅŸtirak bedeli ve gÃ¼vence parasÄ± ve benzeri giderler kiracÄ± tarafÄ±ndan karÅŸÄ±lanacaktÄ±r.</p>
  <p class="pdf-p">KiracÄ± kiralananÄ±n direncini ve inÅŸa biÃ§imini bozabilecek herhangi bir davranÄ±ÅŸta bulunamaz.</p>
  <p class="pdf-p">KiracÄ± belediye ve itfaiye talimatlarÄ±na uymayÄ±, kiralananda yanÄ±cÄ±, patlayÄ±cÄ± ve sair her tÃ¼rlÃ¼ tehlikeli malzeme bulundurmamayÄ±, aksi halde doÄŸacak zararlarÄ± tazmin etmeyi beyan, kabul ve taahhÃ¼t etmiÅŸtir.</p>
  <p class="pdf-p">SÃ¶zleÅŸme'nin uygulanmasÄ±nda Kiraya Veren veya KiracÄ± tarafÄ±ndan aktarÄ±lmÄ±ÅŸ ya da bundan sonra aktarÄ±lacak olan KiÅŸisel Verilere iliÅŸkin olarak Kiraya Veren, 6698 sayÄ±lÄ± KiÅŸisel Verilerin KorunmasÄ± Kanunu'nda yer alan ilkelere uygun olarak bu verileri iÅŸlemek, saklamak, veri gÃ¼venliÄŸini saÄŸlamak ve KiracÄ±nÄ±n izni olmaksÄ±zÄ±n Ã¼Ã§Ã¼ncÃ¼ kiÅŸilere aktarmamakla yÃ¼kÃ¼mlÃ¼dÃ¼r.</p>
  <p class="pdf-p">KiracÄ± kiralananÄ±n su, elektrik, Ä±sÄ±nma ve sair tesisatlarÄ±nÄ±n ve ekipmanlarÄ±nÄ±n (kombi vs.) gerekli periyodik bakÄ±mlarÄ±nÄ± bizzat yaptÄ±rmakla yÃ¼kÃ¼mlÃ¼ olup, tesisatlarda oluÅŸabilecek arÄ±zalardan doÄŸacak maddi zararlarÄ± kiraya verenden isteyemez.</p>
  <p class="pdf-p">Kira sÃ¶zleÅŸmesinin devam etmesi halinde takip eden diÄŸer yÄ±llar iÃ§in kira artÄ±ÅŸÄ± TÃœFE${artis?' ('+artis+')':''} oranÄ±nda artÄ±rÄ±lacaktÄ±r ve iÅŸbu sÃ¶zleÅŸme 1(bir) yÄ±l daha aynÄ± maddeler geÃ§erli olmak Ã¼zere yenilenmiÅŸ sayÄ±lacaktÄ±r.</p>
  <p class="pdf-p">Kira bedeli AYLIK OLARAK Ã–DENECEKTÄ°R. Kira bedeli her ayÄ±n ${odemeGun}. GÃ¼nÃ¼ arasÄ±nda (en geÃ§ ayÄ±n ${odemeGun}'inde) Ã¶denecektir.</p>
  <p class="pdf-p">Kiralanan mecura iliÅŸkin olarak emlak vergisi ile gayrimenkulÃ¼n aynÄ±na iliÅŸkin vergiler hariÃ§ olmak Ã¼zere, tahakkuk edecek su, elektrik, doÄŸalgaz bedelleri ve Ã§evre temizlik gibi vergiler ile bina iÃ§in belirlenmiÅŸ olduÄŸu ortak giderlerin tamamÄ± kiracÄ± tarafÄ±ndan ayrÄ±ca Ã¶denecektir.</p>
  <p class="pdf-p">Kiralanan dairede ve demirbaÅŸlarda herhangi bir zarar-ziyan olmadÄ±ÄŸÄ±, daire sahibine kira, elektrik, su, doÄŸal gaz ve yÃ¶netim giderlerine ait bir borÃ§ olmadÄ±ÄŸÄ± tevsik edildiÄŸinde, mal sahibi, depozitoyu bila faiz aynen iade etmeyi, daire ve demirbaÅŸlarda zarar-ziyan ve borÃ§larÄ±n mevcudiyeti durumunda ise kiracÄ±, bunun depozitodan tazmini/mahsubunu peÅŸinen kabul ederler. KiracÄ± hiÃ§bir ÅŸekilde depozitoyu kiradan mahsup edemez, teminatlardan faiz isteyemez.</p>
  <p class="pdf-p">Depozito bedeli <strong>${depozito}</strong> olarak ev sahibinin: <strong>${iban} (${banka})</strong> numaralÄ± hesabÄ±na yatÄ±rÄ±lmÄ±ÅŸtÄ±r. (TAHLÄ°YE DURUMUNDA AYNI ÃœCRETÄ° ALACAKTIR)</p>
  <p class="pdf-p">KiralananÄ±n borÃ§suz, hasarsÄ±z tahliyesine mÃ¼teakip, en geÃ§ 7 gÃ¼n iÃ§erisinde depozito bedeli kiracÄ±ya iade edecektir. (DAÄ°RE BOYALI TESLÄ°M EDÄ°LMÄ°ÅTÄ°R.)</p>
  <p class="pdf-p">Ä°ÅŸbu belirli sÃ¼reli kira sÃ¶zleÅŸmesinin sÃ¼resinin sona ermesine dayalÄ± olarak feshi ve uzamasÄ±, 6098 sayÄ±lÄ± TÃ¼rk BorÃ§lar Kanunu'nun 347. maddesinde belirtilen ÅŸekilde gerÃ§ekleÅŸir.</p>
  <p class="pdf-p">Kira sÃ¶zleÅŸmesi, hitamÄ±ndan evvel taraflarÄ±n tek taraflÄ± fesih iradesi ile haklÄ± bir neden dayandÄ±rÄ±lmaksÄ±zÄ±n feshedilemez.</p>
  <p class="pdf-p">MÃ¼ÅŸterek borÃ§lu â€“ mÃ¼teselsil kefilin kefalet sÃ¼resi 1(bir) yÄ±l ve iÅŸbu sÃ¶zleÅŸmede yazÄ±lÄ± olan kira bedeli kadar olup, sÃ¶zleÅŸme aynÄ± koÅŸullarda bir yÄ±l daha uzamÄ±ÅŸ olduÄŸu takdirde MÃ¼ÅŸterek borÃ§lu â€“ mÃ¼teselsil kefalet aynÄ± ÅŸekilde devam eder.</p>
  <p class="pdf-p">KiracÄ± apartman/site ile ilgili kararlara aynen uyacaktÄ±r.</p>
  <p class="pdf-p">KiracÄ±, kira sÃ¶zleÅŸmesinin sona ermesi veya gayrimenkulÃ¼n satÄ±lÄ±ÄŸa Ã§Ä±kartÄ±lmasÄ± halinde, kiralananÄ±n gezilmesine ve incelenmesine izin vermek zorundadÄ±r. Bu izin sÃ¼releri azami haftada 2 gÃ¼n ve ikiÅŸer saat ÅŸeklinde olacaktÄ±r. Ä°ÅŸbu gÃ¼nler kiracÄ± ve kiraya veren tarafÄ±ndan ortak ÅŸekilde belirlenemezse her haftanÄ±n Ã‡arÅŸamba ve Cumartesi gÃ¼nleri 17.00-19.00 saatleri arasÄ±nda olacaktÄ±r.</p>
  <p class="pdf-p">Ä°ÅŸ bu kira kontratÄ± 13 genel 24 Ã¶zel madde'den ibaret sÃ¶zleÅŸme tÃ¼m hÃ¼kÃ¼mleri okuduktan ve anlaÅŸÄ±ldÄ±ktan sonra 2 nÃ¼sha dÃ¼zenlenip <strong>${tarih}</strong> Tarihinde imza edilmiÅŸtir.</p>
  <hr class="pdf-divider">
  <div class="pdf-imza-grid iki">
    <div class="pdf-imza-box"><div class="pdf-imza-lbl">KÄ°RACI</div><div class="pdf-imza-alan"></div><div class="pdf-imza-ad">${gv('f_kiraci')||'â€”'}</div><div class="pdf-imza-tc">TC: ${d(gv('f_kiraci_tc'))}</div><div class="pdf-imza-tarih">Tarih: ${tarih}</div></div>
    <div class="pdf-imza-box"><div class="pdf-imza-lbl">KÄ°RAYA VEREN</div><div class="pdf-imza-alan"></div><div class="pdf-imza-ad">${gv('f_kiralayan')||'â€”'}</div><div class="pdf-imza-tc">TC: ${d(gv('f_kiralayan_tc'))}</div><div class="pdf-imza-tarih">Tarih: ${tarih}</div></div>
  </div>
  ${gv('f_kefil')?`<div class="pdf-imza-grid" style="grid-template-columns:1fr;max-width:50%;margin-top:14px"><div class="pdf-imza-box"><div class="pdf-imza-lbl">MÃœÅTEREK BORÃ‡LU MÃœTESELSÄ°L KEFÄ°L</div><div class="pdf-imza-alan"></div><div class="pdf-imza-ad">${gv('f_kefil')}</div><div class="pdf-imza-tc">TC: ${d(gv('f_kefil_tc'))}</div><div class="pdf-imza-tarih">Tarih: ${tarih}</div></div></div>`:''}
  ${demirbas?`<hr class="pdf-divider"><div class="pdf-madde-baslik">DEMÄ°RBAÅ LÄ°STESÄ°</div><div class="pdf-tasÄ±nmaz-box"><p class="pdf-p" style="margin:0;white-space:pre-wrap">${demirbas}</p></div>`:''}
  <div class="pdf-footer-bar"><span>Ã‡elebioÄŸlu Gayrimenkul Â· Gaziler Mah. Gaziler Cad. 1721 Sk. No: 1/B Gebze/KOCAELÄ°</span><span>${docNo} | ${today}</span></div>`;
}

function buildTahliyePDF(docNo,today){
  const kiraSozTarih=gv('f_kira_sozlesme_tarihi')||'â€¦â€¦ / â€¦â€¦ / â€¦â€¦';
  const taahhutTarih=gv('f_tarih')||today;
  const tahliyeTarih=gv('f_tahliye_tarihi')||'â€¦â€¦ / â€¦â€¦ / â€¦â€¦';
  return antet(docNo)+`
  <div class="pdf-title-block"><h2>T A H L Ä° Y E &nbsp;&nbsp;&nbsp; T A A H H Ãœ D Ãœ</h2><div class="pdf-type-bar">ğŸšª TAHLÄ°YE TAAHHÃœDÃœ</div></div>
  <div class="pdf-ref-box"><div><div class="pdf-ref-k">Belge No</div><div class="pdf-ref-v">${docNo}</div></div><div><div class="pdf-ref-k">TaahhÃ¼t Tarihi</div><div class="pdf-ref-v">${taahhutTarih}</div></div><div><div class="pdf-ref-k">DÃ¼zenleyen</div><div class="pdf-ref-v">${currentUser?.name||'â€”'}</div></div></div>
  <div class="pdf-tasÄ±nmaz-box" style="margin-bottom:14px">
    <div class="pdf-row"><div class="pdf-key">TAHLÄ°YE TAAHHÃœDÃœNDE BULUNAN KÄ°RACI</div><div class="pdf-val"></div></div>
    <div class="pdf-row"><div class="pdf-key">ADI-SOYADI</div><div class="pdf-val">${d(gv('f_kiraci'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">TC KÄ°MLÄ°K NO</div><div class="pdf-val">${d(gv('f_kiraci_tc'))}</div></div>
  </div>
  <div class="pdf-tasÄ±nmaz-box" style="margin-bottom:14px">
    <div class="pdf-row"><div class="pdf-key">KÄ°RAYA VEREN</div><div class="pdf-val"></div></div>
    <div class="pdf-row"><div class="pdf-key">ADI-SOYADI</div><div class="pdf-val">${d(gv('f_kiralayan'))}</div></div>
    <div class="pdf-row"><div class="pdf-key">TC KÄ°MLÄ°K NO</div><div class="pdf-val">${d(gv('f_kiralayan_tc'))}</div></div>
  </div>
  <div class="pdf-tasÄ±nmaz-box" style="margin-bottom:14px">
    <div class="pdf-row"><div class="pdf-key">TAHLÄ°YE TAAHHÃœDÃœNE KONU TAÅINMAZ</div><div class="pdf-val"></div></div>
    <div class="pdf-row"><div class="pdf-key">Ä°L</div><div class="pdf-val">${gv('f_il')||'â€¦â€¦'}</div></div>
    <div class="pdf-row"><div class="pdf-key">Ä°LÃ‡E</div><div class="pdf-val">${gv('f_ilce')||'â€¦â€¦'}</div></div>
    <div class="pdf-row"><div class="pdf-key">MAHALLE</div><div class="pdf-val">${gv('f_mahalle')||'â€¦â€¦'}</div></div>
    <div class="pdf-row"><div class="pdf-key">ADA</div><div class="pdf-val">${gv('f_ada')||'â€¦â€¦'}</div></div>
    <div class="pdf-row"><div class="pdf-key">PARSEL</div><div class="pdf-val">${gv('f_parsel')||'â€¦â€¦'}</div></div>
    <div class="pdf-row"><div class="pdf-key">BAÄIMSIZ BÃ–LÃœM NO</div><div class="pdf-val">${gv('f_bb_no')||'â€¦â€¦'}</div></div>
    <div class="pdf-row"><div class="pdf-key">AÃ‡IK ADRESÄ°</div><div class="pdf-val">${gv('f_adres')||'â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦'}</div></div>
  </div>
  <div class="pdf-tasÄ±nmaz-box" style="margin-bottom:18px">
    <div class="pdf-row"><div class="pdf-key">KÄ°RA SÃ–ZLEÅMESÄ° TARÄ°HÄ°</div><div class="pdf-val">${kiraSozTarih}</div></div>
    <div class="pdf-row"><div class="pdf-key">TAHLÄ°YE TAAHHÃœDÃœ TARÄ°HÄ°</div><div class="pdf-val">${taahhutTarih}</div></div>
    <div class="pdf-row"><div class="pdf-key">KÄ°RALANANIN TAHLÄ°YE TARÄ°HÄ°</div><div class="pdf-val"><strong>${tahliyeTarih}</strong></div></div>
  </div>
  <div class="pdf-madde-baslik">AÃ‡IKLAMA / TAAHHÃœT :</div>
  <div class="pdf-not-box" style="line-height:2.1;font-size:12px">
    <strong>${kiraSozTarih}</strong> tarihli kira sÃ¶zleÅŸmesi ile kiralamÄ±ÅŸ bulunduÄŸum ve halen kiracÄ± olarak kullanmakta bulunduÄŸum; <strong>${gv('f_il')||'â€¦â€¦'} / ${gv('f_ilce')||'â€¦â€¦'} / ${gv('f_mahalle')||'â€¦â€¦'}</strong> Mahallesi, Ada: <strong>${gv('f_ada')||'â€¦â€¦'}</strong>, Parsel: <strong>${gv('f_parsel')||'â€¦â€¦'}</strong>, BaÄŸÄ±msÄ±z BÃ¶lÃ¼m No: <strong>${gv('f_bb_no')||'â€¦â€¦'}</strong>, AÃ§Ä±k Adresi: <strong>${gv('f_adres')||'â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦'}</strong> olan kiralananÄ±; ayrÄ±ca hiÃ§bir ihtar, ihbar veya protesto Ã§ekilmesine gerek kalmaksÄ±zÄ±n, kayÄ±tsÄ±z ve ÅŸartsÄ±z olarak, 6098 sayÄ±lÄ± TÃ¼rk BorÃ§lar Kanununun 352 v.d. maddeleri gereÄŸince <strong>${tahliyeTarih}</strong> tarihinde tahliye edeceÄŸimi, kiralananÄ± boÅŸ, temiz, mÃ¼kemmel ve sÃ¶zleÅŸmede belirtilen ÅŸekli ile kiraya verene teslim edeceÄŸimi, kabul, beyan ve taahhÃ¼t ederim.
  </div>
  <hr class="pdf-divider">
  <div class="pdf-imza-grid iki">
    <div class="pdf-imza-box"><div class="pdf-imza-lbl">TAHLÄ°YE TAAHHÃœDÃœNDE BULUNAN KÄ°RACI</div><div class="pdf-imza-alan"></div><div class="pdf-imza-ad">${gv('f_kiraci')||'â€”'}</div><div class="pdf-imza-tc">TC: ${d(gv('f_kiraci_tc'))}</div><div class="pdf-imza-tarih">Tarih: ${taahhutTarih}</div></div>
    <div class="pdf-imza-box"><div class="pdf-imza-lbl">KÄ°RAYA VEREN</div><div class="pdf-imza-alan"></div><div class="pdf-imza-ad">${gv('f_kiralayan')||'â€”'}</div><div class="pdf-imza-tc">TC: ${d(gv('f_kiralayan_tc'))}</div><div class="pdf-imza-tarih">Tarih: ${taahhutTarih}</div></div>
  </div>
  <div class="pdf-footer-bar"><span>Ã‡elebioÄŸlu Gayrimenkul Â· Gaziler Mah. Gaziler Cad. 1721 Sk. No: 1/B Gebze/KOCAELÄ°</span><span>${docNo} | ${today}</span></div>`;
}

// â”€â”€ YAZDIR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function printPDF(){
  const content=document.getElementById('pdfContent').innerHTML;
  const printWin=window.open('','_blank','width=900,height=700');
  printWin.document.write(`<!DOCTYPE html><html lang="tr"><head><meta charset="UTF-8"><title>Ã‡elebioÄŸlu Gayrimenkul</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>*{margin:0;padding:0;box-sizing:border-box;-webkit-print-color-adjust:exact;print-color-adjust:exact}body{font-family:'DM Sans',sans-serif;background:#fff;color:#1a1812;font-size:11.5px;line-height:1.8}.pdf-doc{padding:28px 36px}.pdf-letterhead{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px;padding-bottom:18px;border-bottom:2.5px solid #1a1a2e}.pdf-lb-brand{display:flex;align-items:center;gap:12px}.pdf-lb-icon{width:44px;height:44px;background:#1a1a2e;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.pdf-lb-name{font-size:20px;font-weight:800}.pdf-lb-sub{font-size:9px;color:#8a8474;margin-top:2px}.pdf-meta{text-align:right;font-size:10px;color:#6b7a99;line-height:1.9}.doc-no{font-family:'DM Mono',sans-serif;font-size:12px;font-weight:700;background:#f0ede4;padding:3px 10px;border-radius:5px;color:#1a1812;display:inline-block;margin-bottom:4px}.pdf-title-block{text-align:center;margin:20px 0;background:#f5f5f2;border-radius:8px;padding:20px}.pdf-title-block h2{font-family:'Playfair Display',serif;font-size:14px;color:#1a1812;margin-bottom:8px;letter-spacing:1.5px;text-transform:uppercase}.pdf-type-bar{display:inline-block;padding:5px 18px;background:#1a1a2e;color:#c9960d;font-size:9px;font-weight:700;letter-spacing:2px;border-radius:100px}.pdf-ref-box{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;background:#f9f7f2;border:1px solid #e8e4d8;border-radius:7px;padding:12px 16px;margin-bottom:20px}.pdf-ref-k{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;color:#8a8474;margin-bottom:3px}.pdf-ref-v{font-size:12px;font-weight:600;color:#1a1812}.pdf-madde-baslik{font-size:11px;font-weight:700;color:#1a1812;margin:16px 0 7px;text-transform:uppercase;letter-spacing:.5px}.pdf-p{margin-bottom:9px;text-align:justify;line-height:1.85;font-size:11px;color:#1a1812}.pdf-taraf-tablo{width:100%;border-collapse:collapse;margin-bottom:10px;font-size:10.5px}.pdf-taraf-tablo td{padding:3px 6px;vertical-align:top;line-height:1.6}.pdf-taraf-tablo td:first-child{width:150px;color:#8a8474;font-weight:600;font-size:10px}.pdf-taraf-baslik{font-size:9.5px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:#5a5040;margin:8px 0 4px;padding:3px 6px;background:#f0ede4;border-radius:4px}.pdf-tasÄ±nmaz-box{background:#faf8f4;border:1px solid #ddd9ce;border-radius:6px;padding:12px 16px;margin:8px 0 14px}.pdf-row{display:grid;grid-template-columns:160px 1fr;gap:4px;margin-bottom:4px;font-size:10.5px}.pdf-row:last-child{margin-bottom:0}.pdf-key{color:#8a8474;font-weight:600;font-size:10px}.pdf-val{color:#1a1812}.pdf-divider{border:none;border-top:1px solid #ddd9ce;margin:16px 0}.pdf-not-box{background:#f5e9c0;border:1px solid #d4a017;border-radius:6px;padding:12px 16px;margin:12px 0;font-size:11px;line-height:2}.pdf-imza-grid{display:grid;gap:16px;margin-top:28px}.pdf-imza-grid.iki{grid-template-columns:1fr 1fr}.pdf-imza-grid.dort{grid-template-columns:1fr 1fr 1fr 1fr}.pdf-imza-box{border:1px solid #c8c0b0;border-radius:6px;padding:12px 14px}.pdf-imza-lbl{font-size:8.5px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:#8a8474;margin-bottom:8px}.pdf-imza-alan{height:48px;border-bottom:1.5px solid #1a1812;margin-bottom:8px}.pdf-imza-ad{font-size:11px;font-weight:600;color:#1a1812}.pdf-imza-tc{font-size:9.5px;color:#8a8474;margin-top:2px}.pdf-imza-tarih{font-size:9.5px;color:#8a8474;margin-top:4px}.pdf-footer-bar{margin-top:24px;padding-top:10px;border-top:1px solid #ddd9ce;display:flex;justify-content:space-between;font-size:9px;color:#aaa}@page{size:A4;margin:10mm 12mm}@media print{body{margin:0}}</style></head>
<body><div class="pdf-doc">${content}</div>
<script>window.onload=function(){window.print();window.onafterprint=function(){window.close();};};<\/script></body></html>`);
  printWin.document.close();
}
function closePdfModal(){document.getElementById('pdfModal').classList.add('hidden');}
window.printPDF=printPDF;
window.closePdfModal=closePdfModal;

// â”€â”€ SÃ–ZLEÅME TABLOSU â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderContractTable(list,showDelete=true){
  if(!list.length)return '<div class="empty-state">HenÃ¼z sÃ¶zleÅŸme yok.</div>';
  const tn={satis:'ğŸ¡ SatÄ±ÅŸ',kira:'ğŸ”‘ Kira',tahliye:'ğŸšª Tahliye'};
  const db={tamamlandi:'<span class="badge badge-ok">TamamlandÄ±</span>',taslak:'<span class="badge badge-taslak">Taslak</span>'};
  const isAdmin=currentUser&&currentUser.role==='admin';
  return `<table><thead><tr><th>No</th><th>TÃ¼r</th><th>Taraflar</th><th>MÃ¼lk</th><th>Tarih</th><th>Durum</th>${isAdmin?'<th>DanÄ±ÅŸman</th>':''}<th>Ä°ÅŸlem</th></tr></thead><tbody>`+
  list.map(c=>{
    const taraf=c.type==='satis'?`${esc(c.satici)||'â€”'} â†’ ${esc(c.alici)||'â€”'}`:c.type==='kira'?`${esc(c.kiralayan)||'â€”'} â†’ ${esc(c.kiraci)||'â€”'}`:esc(c.kiralayan)||'â€”';
    const badge=c.type==='satis'?'badge-satis':c.type==='kira'?'badge-kira':'badge-aracilik';
    const danismanCell=isAdmin?`<td><span style="font-size:12px">${esc(c.createdByName)||'â€”'}</span></td>`:'';
    const safeId=esc(c.id);
    return `<tr><td><span style="font-family:'DM Mono',monospace;font-size:11px;color:var(--muted)">${safeId}</span></td><td><span class="badge ${badge}">${tn[c.type]}</span></td><td>${taraf}</td><td style="max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${esc(c.adres)||'â€”'}</td><td>${esc(c.date)||'â€”'}</td><td>${db[c.durum]||''}</td>${danismanCell}<td style="display:flex;gap:6px"><button class="btn-sm" onclick="viewContract('${safeId}')">GÃ¶rÃ¼ntÃ¼le</button>${showDelete&&isAdmin?`<button class="btn-sm danger" onclick="deleteContract('${safeId}')">Sil</button>`:''}</td></tr>`;
  }).join('')+'</tbody></table>';
}

function renderContracts(){
  const visible=getVisibleContracts();
  const filtered=visible.filter(c=>{
    const mt=currentFilter==='hepsi'||c.type===currentFilter;
    const q=currentSearchQ.toLowerCase();
    return mt&&(!q||JSON.stringify(c).toLowerCase().includes(q));
  });
  document.getElementById('contractsTable').innerHTML=renderContractTable(filtered);
  document.getElementById('contractCount').textContent=`${filtered.length} SÃ¶zleÅŸme`;
}
function filterContracts(f,btn){currentFilter=f;document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');renderContracts();}
function searchContracts(q){currentSearchQ=q;renderContracts();}
window.filterContracts=filterContracts;
window.searchContracts=searchContracts;

function viewContract(id){
  const c=contracts.find(x=>x.id===id);
  if(!c)return;
  const today=new Date().toLocaleDateString('tr-TR',{day:'2-digit',month:'long',year:'numeric'});
  const titles={satis:'GAYRÄ°MENKUL SATIÅINA CAYMA AKÃ‡ELÄ° ARACILIK SÃ–ZLEÅMESÄ°',kira:'KONUT KÄ°RA SÃ–ZLEÅMESÄ°',tahliye:'TAHLÄ°YE TAAHHÃœDÃœ'};
  const icons={satis:'ğŸ¡',kira:'ğŸ”‘',tahliye:'ğŸšª'};
  let taraflar='',mali='';
  if(c.type==='satis'){taraflar=`<div class="pdf-row"><div class="pdf-key">SatÄ±cÄ±</div><div class="pdf-val">${esc(c.satici)||'â€”'}</div></div><div class="pdf-row"><div class="pdf-key">AlÄ±cÄ±</div><div class="pdf-val">${esc(c.alici)||'â€”'}</div></div>`;mali=`<div class="pdf-row"><div class="pdf-key">SatÄ±ÅŸ Bedeli</div><div class="pdf-val">${c.fiyat?fmt(c.fiyat)+' â‚º':'â€”'}</div></div>`;}
  else if(c.type==='kira'){taraflar=`<div class="pdf-row"><div class="pdf-key">Kiraya Veren</div><div class="pdf-val">${esc(c.kiralayan)||'â€”'}</div></div><div class="pdf-row"><div class="pdf-key">KiracÄ±</div><div class="pdf-val">${esc(c.kiraci)||'â€”'}</div></div>`;mali=`<div class="pdf-row"><div class="pdf-key">AylÄ±k Kira</div><div class="pdf-val">${c.kira?fmt(c.kira)+' â‚º':'â€”'}</div></div>`;}
  else{taraflar=`<div class="pdf-row"><div class="pdf-key">Kiraya Veren</div><div class="pdf-val">${esc(c.kiralayan)||'â€”'}</div></div><div class="pdf-row"><div class="pdf-key">KiracÄ±</div><div class="pdf-val">${esc(c.kiraci)||'â€”'}</div></div>`;mali='';}
  document.getElementById('pdfContent').innerHTML=`${antet(esc(c.id))}<div class="pdf-title-block"><h2>${titles[c.type]}</h2><div class="pdf-type-bar">${icons[c.type]} ${c.type.toUpperCase()}</div></div><div class="pdf-ref-box"><div><div class="pdf-ref-k">No</div><div class="pdf-ref-v">${esc(c.id)}</div></div><div><div class="pdf-ref-k">Tarih</div><div class="pdf-ref-v">${esc(c.date)||'â€”'}</div></div><div><div class="pdf-ref-k">DanÄ±ÅŸman</div><div class="pdf-ref-v">${esc(c.createdByName)||'â€”'}</div></div></div><div class="pdf-tasÄ±nmaz-box">${taraflar}<div class="pdf-row"><div class="pdf-key">Adres</div><div class="pdf-val">${esc(c.adres)||'â€”'}</div></div>${mali}</div><div class="pdf-footer-bar"><span>Ã‡elebioÄŸlu Gayrimenkul</span><span>${esc(c.id)} â€” ArÅŸiv KopyasÄ±</span></div>`;
  document.getElementById('pdfModal').classList.remove('hidden');
}
async function deleteContract(id){
  if(!confirm('Bu sÃ¶zleÅŸmeyi kalÄ±cÄ± olarak silmek istediÄŸinizden emin misiniz?'))return;
  const c=contracts.find(x=>x.id===id);
  if(c)await fbDeleteContract(c);
  await fbLoadContracts();
  renderContracts();
  showToast('SÃ¶zleÅŸme silindi.');
}
window.viewContract=viewContract;
window.deleteContract=deleteContract;

// â”€â”€ RAPORLAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderReports(){
  const visible=getVisibleContracts();
  const s=visible.filter(c=>c.type==='satis').length,k=visible.filter(c=>c.type==='kira').length,a=visible.filter(c=>c.type==='tahliye').length;
  const total=visible.length||1;
  document.getElementById('chartTypes').innerHTML=bar('SatÄ±ÅŸ',s,total,'#1a4a2e')+bar('Kira',k,total,'#1a2a4a')+bar('Tahliye',a,total,'#4a1a1a');
  const months=['Tem','AÄŸu','Eyl','Eki','Kas','Ara'];
  const vals=[0,0,0,0,0,visible.length];
  const mx=Math.max(...vals,1);
  document.getElementById('chartMonths').innerHTML=months.map((m,i)=>bar(m,vals[i],mx,'#b8860b')).join('');
  document.getElementById('reportTable').innerHTML=`<tr><td>Toplam SÃ¶zleÅŸme</td><td><strong>${visible.length}</strong></td><td></td></tr><tr><td>Tamamlanan</td><td><strong>${visible.filter(c=>c.durum==='tamamlandi').length}</strong></td><td></td></tr><tr><td>Taslak</td><td><strong>${visible.filter(c=>c.durum==='taslak').length}</strong></td><td></td></tr><tr><td>SatÄ±ÅŸ</td><td><strong>${s}</strong></td><td></td></tr><tr><td>Kira</td><td><strong>${k}</strong></td><td></td></tr><tr><td>Tahliye</td><td><strong>${a}</strong></td><td></td></tr>`;
}
function bar(lbl,val,max,color){const pct=Math.round((val/max)*100);return `<div class="chart-bar-row"><div class="chart-bar-lbl">${lbl}</div><div class="chart-bar-bg"><div class="chart-bar-fill" style="width:${pct}%;background:${color}"></div></div><div class="chart-bar-val">${val}</div></div>`;}

// â”€â”€ ADMÄ°N â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function renderAdmin(){
  // KullanÄ±cÄ± profillerini Firestore'dan yÃ¼kle (ÅŸifre iÃ§ermez)
  users = await fbLoadAllUserProfiles();
  document.getElementById('adminUserCount').textContent=users.length;
  document.getElementById('adminAdminCount').textContent=users.filter(u=>u.role==='admin').length;
  document.getElementById('adminContractCount').textContent=contracts.length;
  document.getElementById('adminUsersTable').innerHTML=users.map(u=>`<tr>
    <td><div style="display:flex;align-items:center;gap:10px"><div class="staff-avatar">${esc(u.name||'?').split(' ').map(x=>x[0]).join('').slice(0,2)}</div>${esc(u.name)}</div></td>
    <td style="font-family:'DM Mono',monospace;font-size:12px">${esc(u.email)}</td>
    <td><span class="badge ${u.role==='admin'?'badge-admin':'badge-taslak'}">${u.role==='admin'?'YÃ¶netici':'DanÄ±ÅŸman'}</span></td>
    <td>${u.active===false?'<span class="badge badge-aracilik">Devre DÄ±ÅŸÄ±</span>':'<span class="badge badge-ok">Aktif</span>'}</td>
    <td>${u.uid!==currentUser?.uid?`<button class="btn-sm danger" onclick="removeUser('${esc(u.uid)}')">KaldÄ±r</button>`:'<span style="font-size:12px;color:var(--muted)">Sen</span>'}</td>
  </tr>`).join('');
  const danismanlar=users.filter(u=>u.role==='user');
  document.getElementById('adminPerfTable').innerHTML=danismanlar.map(u=>{
    const mine=contracts.filter(c=>c.createdBy===u.uid);
    const s=mine.filter(c=>c.type==='satis').length,k=mine.filter(c=>c.type==='kira').length,a=mine.filter(c=>c.type==='tahliye').length;
    return `<tr><td><div style="display:flex;align-items:center;gap:10px"><div class="staff-avatar">${esc(u.name||'?').split(' ').map(x=>x[0]).join('').slice(0,2)}</div>${esc(u.name)}</div></td><td style="text-align:center"><strong>${mine.length}</strong></td><td style="text-align:center"><span class="badge badge-satis">${s}</span></td><td style="text-align:center"><span class="badge badge-kira">${k}</span></td><td style="text-align:center"><span class="badge badge-aracilik">${a}</span></td></tr>`;
  }).join('')||'<tr><td colspan="5" class="empty-state">HenÃ¼z danÄ±ÅŸman yok.</td></tr>';
}
function openAddUserModal(){document.getElementById('addUserModal').classList.remove('hidden');}
function closeAddUserModal(){document.getElementById('addUserModal').classList.add('hidden');}
async function addUser(){
  const name  = document.getElementById('newUserName').value.trim();
  const email = document.getElementById('newUserEmail').value.trim();
  const pass  = document.getElementById('newUserPass').value;
  const role  = document.getElementById('newUserRole').value;
  if(!name||!email||!pass){showToast('TÃ¼m alanlarÄ± doldurun.');return;}
  if(pass.length < 6){showToast('Åifre en az 6 karakter olmalÄ±dÄ±r.');return;}

  const btn = document.querySelector('#addUserModal .btn-primary');
  btn.disabled=true; btn.textContent='Ekleniyor...';

  try{
    // 1. Auth'ta kullanÄ±cÄ± oluÅŸtur
    const cred = await createUserWithEmailAndPassword(secondaryAuth, email, pass);
    const newUid = cred.user.uid;

    // 2. Ä°KÄ°NCÄ°L OTURUMU KAPATMADAN Ã–NCE Firestore'a kaydet
    const profile = { name, email, role, active: true, createdAt: new Date().toISOString() };
    await fbSaveUserProfile(newUid, profile);

    // 3. Åimdi ikincil oturumu kapat
    try { await signOut(secondaryAuth); } catch(e2) { /* Ã¶nemli deÄŸil */ }

    // 4. BaÅŸarÄ±
    users.push({...profile, uid: newUid});
    closeAddUserModal();
    await renderAdmin();
    showToast('âœ“ ' + name + ' eklendi!');
    ['newUserName','newUserEmail','newUserPass'].forEach(id=>{document.getElementById(id).value='';});

  } catch(e){
    console.error('KullanÄ±cÄ± ekleme hatasÄ±:', e.code, e.message);
    if(e.code==='auth/email-already-in-use'){
      // Auth'ta var ama Firestore'da yoksa profili kurtarmayÄ± dene
      showToast('âš ï¸ Bu e-posta Auth'ta zaten kayÄ±tlÄ±. Firebase Console'dan UID'yi alÄ±p Firestore'a ekleyin.');
    } else if(e.code==='auth/weak-password'){
      showToast('âš ï¸ Åifre en az 6 karakter olmalÄ±dÄ±r.');
    } else {
      showToast('âš ï¸ KullanÄ±cÄ± eklenemedi: ' + e.message);
    }
  } finally {
    btn.disabled=false; btn.textContent='Ekle';
  }
}
async function removeUser(uid){
  if(!uid||uid===currentUser?.uid){showToast('Kendi hesabÄ±nÄ±zÄ± silemezsiniz.');return;}
  if(!confirm('Bu kullanÄ±cÄ±yÄ± kalÄ±cÄ± olarak silmek istediÄŸinizden emin misiniz?'))return;
  try{
    // Firestore'dan tamamen sil
    await deleteDoc(doc(db,'users',uid));
    users = users.filter(u=>u.uid!==uid);
    await renderAdmin();
    showToast('âœ“ KullanÄ±cÄ± silindi.');
    // Not: Firebase Authentication kaydÄ± Firebase Console'dan manuel silinmelidir.
  } catch(e){
    showToast('âš ï¸ Ä°ÅŸlem baÅŸarÄ±sÄ±z: '+e.message);
  }
}
async function fixMissingProfile(e){
  e.preventDefault();
  const email = document.getElementById('newUserEmail').value.trim();
  const name  = document.getElementById('newUserName').value.trim();
  const role  = document.getElementById('newUserRole').value;
  if(!email||!name){ showToast('E-posta ve ad alanlarÄ±nÄ± doldurun.'); return; }

  // Auth'ta zaten var ama UID'yi bilmiyoruz â€” kullanÄ±cÄ±yÄ± sil ve yeniden oluÅŸtur
  const pass = document.getElementById('newUserPass').value;
  if(!pass){ showToast('Åifreyi de girin.'); return; }

  showToast('â³ Profil kurtarÄ±lÄ±yor...');
  try {
    // Ã–nce mevcut secondary kullanÄ±cÄ±yÄ± sil
    try { await signOut(secondaryAuth); } catch(e2){}

    // KullanÄ±cÄ±yÄ± yeniden oluÅŸturmaya Ã§alÄ±ÅŸ â€” eÄŸer baÅŸarÄ±sÄ±z olursa signIn ile UID al
    let uid;
    try {
      const cred = await createUserWithEmailAndPassword(secondaryAuth, email, pass);
      uid = cred.user.uid;
    } catch(e3) {
      if(e3.code === 'auth/email-already-in-use'){
        // Åifreyle giriÅŸ yap, UID'yi al
        const cred2 = await signInWithEmailAndPassword(secondaryAuth, email, pass);
        uid = cred2.user.uid;
      } else { throw e3; }
    }

    // Firestore'a profili kaydet
    const profile = { name, email, role, active: true, createdAt: new Date().toISOString() };
    await fbSaveUserProfile(uid, profile);
    try { await signOut(secondaryAuth); } catch(e4){}

    users.push({...profile, uid});
    closeAddUserModal();
    await renderAdmin();
    showToast('âœ“ ' + name + ' profili kurtarÄ±ldÄ±!');
    ['newUserName','newUserEmail','newUserPass'].forEach(id=>{document.getElementById(id).value='';});
  } catch(err){
    console.error('Kurtarma hatasÄ±:', err);
    showToast('âš ï¸ KurtarÄ±lamadÄ±: ' + err.message);
  }
}
window.fixMissingProfile=fixMissingProfile;
window.openAddUserModal=openAddUserModal;
window.closeAddUserModal=closeAddUserModal;
window.addUser=addUser;
window.removeUser=removeUser;

function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2800);}
</script>
</body>
</html>
